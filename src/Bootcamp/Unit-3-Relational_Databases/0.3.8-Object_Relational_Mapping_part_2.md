# Object Relational Mapping - part 2

## Learning Objectives
* Implement an Object Relational Mapping (ORM) design pattern with relationships between classes

## Pre-requisites

## Lesson
There is an important dimension missing from our 'home grown' ORM implementation - relationships. As we see from the class diagram below, our Restaurants have Menus and our Menus have Menu Items. 
![UML Class Diagram showing relationships between Restaurant, Menu and MenuItem classes](https://user-images.githubusercontent.com/1316724/105141638-5d11d500-5af1-11eb-98ee-d177df9c5894.png)

We want to be able to access our Menus like this:

|Javascript|Java|
```javascript
restaurant.menus 
```
```java
restaurant.getMenus();
```
|Javascript|Java|

and from each Menu we want to be able to access information about each item on the Menu, for example:

|Javascript|Java|
```javascript
restaurant.menus[0].items[0].price // 12.50
```
```java
restaurant.getMenus()[0].getItems()[0].getPrice()
```
|Javascript|Java|

We therefore need to expand our Restaurant class to include a function that will add a Menu instance to the Restaurant:

```javascript
addMenu(menu) {
    this.menus.push(menu);
}
```

and then extend our `save()` method to save Restaurant Menus as well as extend our Restaurant `find()` methods to return the Menus and MenuItems alongside the Restaurant data.

Here is an example of a modififed Restaurant `save()` method.

```javascript
    save() {

        const self = this;

        try {
            return new Promise(function (resolve) {
                Restaurant.db.run(`INSERT INTO RESTAURANTS (name, image) VALUES (?, ?)`, [self.name, self.image], function (err) {
                    if (err) {
                        console.log(err.message);
                        throw err;
                    }
                    self.id = this.lastID; // set the object id to the inserted row id

                    if(self.menus) {
                        // save each menu
                        self.menus.forEach((menu)=> {

                            Restaurant.db.run(`INSERT INTO MENUS (title, restaurant_id) VALUES (?, ?)`, [menu.title, self.id], function (err) {   
                                if (err) {
                                    throw err;
                                }

                                menu.id = this.lastID; // set the object id to the inserted row id            
                                menu.restaurant_id = self.id;
                            })
                        })

                    }
       
                    resolve(self);
                })
            });
        } catch (err) {
            console.log(err)
        }
    }
```

## Assignment

* Enhance the solution from the [Object Relational Mapping - Part 1](https://multiverselearningproducts.github.io/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.7-Object_Relational_Mapping_part_1.html) lesson to include the relationships between your Restaurant and Menu classes and the Menu and Menu Item classes as described above.
* Ensure you have unit tests that cover the new functionality.
* Commit your code into Github and share the link with your coach for review.


### Assignment extension tasks


## Additional resources
