<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> AJAX (Asynchronous JavaScript And XML)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum\Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum\Bootcamp\FAQ.html">FAQ</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_and_Functions.html">0.1.1 JavaScript Objects and Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.6-Asynchronous_JavaScript.html">0.1.6 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.7-Asynchronous_Airport_Data_Load.html">0.1.7 Asynchronous Airport Data Load</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases/index.html">Unit 2 Databases</a><ul><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.1-Logical_Data_Model.html">0.2.1 Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.10-Sequelize_part_2.html">0.2.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.2-Implementing_the_Logical_Data_Model.html">0.2.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.3-Basic_SQL_Commands.html">0.2.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.4-SQL_Joins.html">0.2.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.5-Database_access_using_Node.html">0.2.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.6-Populating_databases_from_JSON.html">0.2.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.7-Object_Relational_Mapping_part_1.html">0.2.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.8-Object_Relational_Mapping_part_2.html">0.2.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.9-Sequelize_part_1.html">0.2.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content/index.html">Unit 3 APIs and Dynamic Content</a><ul><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.1-Web_Servers.html">0.3.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.10-Full_CRUD_operations.html">0.3.10 Full CRUD operations</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.11-Restaurant_ratings.html">0.3.11 Restaurant ratings</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.2-Application_Servers.html">0.3.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.3-Rendering_Dynamic_Content.html">0.3.3 Rendering Dynamic Content</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.4-Responsive_CSS_Grids.html">0.3.4 Responsive CSS Grids</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.5-CSS_Box_Model.html">0.3.5 CSS Box Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.6-Route_Parameters.html">0.3.6 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.7-HTML_Forms.html">0.3.7 HTML Forms</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.8-Server_side_Validation.html">0.3.8 Server side Validation</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.9-CRUD_operations.html">0.3.9 CRUD operations</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development/index.html">Unit 4 Client side development</a><ul><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.1-Client_side_JavaScript.html">0.4.1 Client side JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.2-HTML_DOM_Events.html">0.4.2 HTML DOM Events</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.3-AppRun_framework.html">0.4.3 AppRun framework</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.4-Web_Accessibility.html">0.4.4 Web Accessibility</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.5-Drag_and_Drop.html">0.4.5 Drag and Drop</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.6-Drag_and_Drop_with_AppRun.html">0.4.6 Drag and Drop with AppRun</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.7-AJAX.html">0.4.7 AJAX</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-5-End_Of_Bootcamp_Assessment/index.html">Unit 5 End Of Bootcamp Assessment</a><ul><li><a href="/curriculum\Bootcamp\Unit-5-End_Of_Bootcamp_Assessment\0.5.1-TODO.html">0.5.1 TODO</a></li></ul></li></ul></li><li><a href="/curriculum\Module-2/index.html">Module 2</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.2-The_OpenAPI_spec.html">2.2.2 The OpenAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.3-Build_an_OpenAPI_RESTful_service.html">2.2.3 Build an OpenAPI RESTful service</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.4-Integration_tests.html">2.2.4 Integration tests</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.5-Unit_2_Knowledge_quiz.html">2.2.5 Unit 2 Knowledge quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography/index.html">Unit 3 Cryptography</a><ul><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.1-Hashing_Functions.html">2.3.1 Hashing Functions</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.2-Symmetric_Key_Encryption.html">2.3.2 Symmetric Key Encryption</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.3-Asymmetric_Key_Encryption.html">2.3.3 Asymmetric Key Encryption</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.4-Unit_3_Knowledge_Quiz.html">2.3.4 Unit 3 Knowledge Quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-4-Authentication/index.html">Unit 4 Authentication</a><ul><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.1-Authentication_and_Authorisation.html">2.4.1 Authentication and Authorisation</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.2-What_is_middleware.html">2.4.2 What is middleware</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.3-Session_based_auth.html">2.4.3 Session based auth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.4-Introduction_to_OAuth.html">2.4.4 Introduction to OAuth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.5-Token_based_auth.html">2.4.5 Token based auth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.6-OpenID_Connect.html">2.4.6 OpenID Connect</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.7-Unit_4_Knowledge_Quiz.html">2.4.7 Unit 4 Knowledge Quiz</a></li></ul></li></ul></li><li><a href="/curriculum\Module-3/index.html">Module 3</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>AJAX (Asynchronous JavaScript And XML)</h1>
<h2>Learning Objectives</h2>
<ul>
<li>Explain what AJAX means</li>
<li>Understand what makes a single page app (SPA)</li>
<li>Use <code>XMLHTTPRequest</code> and <code>fetch</code></li>
</ul>
<h2>Pre-requisites</h2>
<p>TODO</p>
<ul>
<li>You will need your todo app</li>
<li>You will need to create an express server</li>
</ul>
<h2>Lesson</h2>
<p><iframe src="https://docs.google.com/presentation/d/e/2PACX-1vT4wCJjWXLsTFfoX-0JzvXu4bNZa-wDE2QfXAn5cOrYhchUekDfDw52QSR_FSfHSeAzCD7aQbokFW4t/embed" width="100%" height="444px" allowfullscreen frameborder=0></iframe></p>
<p>The AJAX pattern lead to a different kind of web site. A site that was closer to an app, one HTML page is loaded, then the following pages and interactions are all driven by JavaScript. It is this pattern that we are going to implement in our group projects. To follow along we'll make a simple server that will store our tasks.</p>
<h3>Create our data server</h3>
<p>This express server will server our single HTML page, and then all consequential requests will be for the data it needs to run. Create a <code>server.js</code> file in your project folder. Create a <code>public</code> folder and put your <code>index.html</code>, <code>style.css</code> and <code>main.js</code> in that folder. Set express up to serve static assets from the <code>public</code> folder, and deal with json requests, finally run your server on port 3000.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)
<span class="hljs-keyword">const</span> app = express()

app.use(express.static(<span class="hljs-string">&#x27;public&#x27;</span>))
app.use(express.urlencoded({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }))
app.use(express.json())

<span class="hljs-keyword">const</span> tasks = [
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Fetch all the tasks&#x27;</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Create a new task&#x27;</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>
    }
]

app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;app server running on port&#x27;</span>, <span class="hljs-number">3000</span>)
})
</code></pre>
<p>I have added some tasks on the server. Our first job will be to fetch these once the page has loaded.</p>
<h3>Making AJAX requests</h3>
<p>We are going to use the <code>fetch</code> API that comes bundled in the javascript runtime in the browser. We need an update function in our AppRun update object that is going to get all the tasks on the server.</p>
<pre><code class="language-javascript">    getTasks: <span class="hljs-keyword">async</span> (state) =&gt; {
        state.tasks = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">&#x27;/tasks&#x27;</span>).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
        <span class="hljs-keyword">return</span> state
    }
</code></pre>
<p>What kind of function is getTasks? We can make a simple 'get' request using <code>fetch</code> it uses the <code>Promise</code> object. <code>fetch</code> will return an HTTP response object, we then need to transform that into usable JSON. In the example above we can expect the <code>/tasks</code> endpoint to return an Array of tasks. We assign that into state and that will trigger a re-render.</p>
<p>On the server we can add the <code>/tasks</code> endpoint:</p>
<pre><code class="language-javascript">app.get(<span class="hljs-string">&#x27;/tasks&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.send(tasks)
})
</code></pre>
<p>The key take away here is - no templates. We don't do templating on the server, we just respond with the data our single page app needs. The next refactor is to create a task on the server, not just on the frontend. Update your <code>add</code> update function, don't push the new task into <code>state.tasks</code>. Instead post it to the server, and then trigger <code>app.run('getTasks')</code>.</p>
<pre><code class="language-javascript">    add: <span class="hljs-function">(<span class="hljs-params">state, form</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> FormData(form)
        <span class="hljs-keyword">const</span> task = {
            <span class="hljs-attr">id</span>: <span class="hljs-built_in">window</span>.crypto.getRandomValues(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">2</span>)).join(<span class="hljs-string">&#x27;&#x27;</span>),
            <span class="hljs-attr">text</span>: data.get(<span class="hljs-string">&#x27;text&#x27;</span>),
            <span class="hljs-attr">highlight</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>
        }
        <span class="hljs-keyword">const</span> postRequest = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
            },
            <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(task)
        }
        fetch(<span class="hljs-string">&#x27;/tasks&#x27;</span>, postRequest).then(<span class="hljs-function">() =&gt;</span> app.run(<span class="hljs-string">&#x27;getTasks&#x27;</span>))
        <span class="hljs-keyword">return</span> state
    },
</code></pre>
<p>Making a POST request is similar to a GET request, only now we include a javascript object with the settings for;</p>
<ul>
<li>method - &quot;POST&quot;</li>
<li>headers - we have to set the type of content we are posting in the header of the request</li>
<li>body - this must be a string, it is where we put our data we want to send to the server</li>
</ul>
<p>On the server we can create an endpoint to receive the <code>postRequest</code>;</p>
<pre><code class="language-javascript">app.post(<span class="hljs-string">&#x27;/tasks&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    tasks.push(req.body)
    res.send()
})
</code></pre>
<p>here we reply with <code>res.send()</code> on the frontend we are waiting for this, we can then make a request for the updated tasks by calling <code>app.run('getTasks')</code>. This is a design choice to demonstrate how one AppRun update function can call another update function, like a chain of events. You could return all the tasks from the POST request above, and then update the state with the new task list all within the 'add' update function.</p>
<h2>Assignment</h2>
<ul>
<li>Set up an app server for yourself</li>
<li>Make AJAX GET requests using <code>fetch</code></li>
<li>Make AJAX POST requests using <code>fetch</code></li>
</ul>
<h2>Assignment extension tasks</h2>
<h2>Additional resources</h2>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>