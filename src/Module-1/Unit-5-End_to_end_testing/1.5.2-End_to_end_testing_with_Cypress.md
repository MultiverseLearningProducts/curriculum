# Introduction

Now we have a good understanding of what End-to-End testing is and what it involves, let's now write some automated tests in Cypress to ensure everything is working as designed. Along the way, there will be testing challenges for you to have a go at.

## Learning Objectives

- Install and run Cypress#
- Set up Cypress
- Write your first Cypress test

## Install and run Cypress

### Step 1

In your project directory, run `npm install cypress --save-dev`.

This will install all of the Cypress dependencies. It may take some time!

### Step 2

Once done, run the command, `./node_modules/.bin/cypress open`. If you have Cypress installed globally, you can just run `cypress open`.

This should open the Cypress GUI.

## Setting up Cypress

### Step 1

You'll notice that Cypress adds the following directories and JSON configuration file:

```text
- cypress
    - fixtures
    - integrations
    - plugins
    - support

- cypress.json

// other files
```

### Step 2

In your `cypress.json` file, we're going to add the URL of your Live Server so we can tell Cypress which URL to load without repeating it for every test. In your file, add:

```json
{
  "baseUrl": "http://127.0.0.1:5500/your_directory/index.html#/",
  "integrationFolder": "cypress/tests"
}
```

In our case, we're running the Live Server on port 5500 and want Cypress to load our `index.html` - the same page where Vue mounts itself on the `app` component. We've also added a configuration item to serve the tests from a `/tests` folder.

### Step 3

Delete the `integrations` folder and create an empty folder in the Cypress directory called `tests`.

> Good to know: all of the tests you add in the tests folder will combine to produce the E2E test coverage we want.

## Typical Cypress test structure

A good test should follow the pattern:

1. Set up the application state (if applicable)
2. Take an action
3. Make an assertion about the resulting application state

If you've written unit tests in Jest or another JavaScript testing framework, then you'll be familiar with the callback style test structure:

```js
describe("The thing you're testing", () => {
  it('should test an aspect of the thing', () => {
    cy.visit('/'); // take an action
    cy.get('some-element').should('have.text', 'some text'); // make an assertion
  });
});
```

## A TDD approach to our first test

Our products really should show an "Out of stock" notice if the stock level is equal to zero and if the product is out of stock, we shouldn't show the Add to cart button. Let's write a failing test for this first, then add the functionality to make it pass.

### Step 1

Cypress recommends adding a data attribute to the element or elements we want to capture. We can of course always capture by CSS ID or class, but both of these things may change at some point and then our tests will break. Add the attribute as follows:

```js
// main.js

const Product = Vue.component('Product', {
  template: `
    <div class="product" data-cy="product">

    // other fields omitted
   `,
});
```

### Step 2

```js
it('should find an out of stock notice and but no add to cart button', () => {
  cy.get('[data-cy=product]')
    .eq(0)
    .should('contain', 'Out of stock :(')
    .and('not.contain', 'Add to cart');
});
```
