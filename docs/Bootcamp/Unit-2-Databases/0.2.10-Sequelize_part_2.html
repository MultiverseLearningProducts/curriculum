<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Sequelize - part 2</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <nav id="navigation"><ul><li><a href="/Bootcamp/index.html">Bootcamp</a><ul><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.1-JavaScript_Objects_And_Functions.html">0.1.1 JavaScript Objects And Functions</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.6-Asynchronous_JavaScript.html">0.1.6 Asynchronous JavaScript</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.7-Asynchronous_Airport_Data_Load.html">0.1.7 Asynchronous Airport Data Load</a></li><li><a href="/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/Bootcamp/Unit-2-Databases/index.html">Unit 2 Databases</a><ul><li><a href="/Bootcamp/Unit-2-Databases/0.2.1-Logical_Data_Model.html">0.2.1 Logical Data Model</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.10-Sequelize_part_2.html">0.2.10 Sequelize part 2</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.2-Implementing_the_Logical_Data_Model.html">0.2.2 Implementing the Logical Data Model</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.3-Basic_SQL_Commands.html">0.2.3 Basic SQL Commands</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.4-SQL_Joins.html">0.2.4 SQL Joins</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.5-Database_access_using_Node.html">0.2.5 Database access using Node</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.6-Populating_databases_from_JSON.html">0.2.6 Populating databases from JSON</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.7-Object_Relational_Mapping_part_1.html">0.2.7 Object Relational Mapping part 1</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.8-Object_Relational_Mapping_part_2.html">0.2.8 Object Relational Mapping part 2</a></li><li><a href="/Bootcamp/Unit-2-Databases/0.2.9-Sequelize_part_1.html">0.2.9 Sequelize part 1</a></li></ul></li></ul></li><li><a href="/Module-2/index.html">Module 2</a><ul><li><a href="/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li></ul></li></ul></li><li><a href="/Module-3/index.html">Module 3</a><ul><li><a href="/Module-3/Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/Module-3/Unit-1-The-SDLC/3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>Sequelize - part 2</h1>
<h2>Pre-requisites</h2>
<p><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.9-Sequelize_part_1.html">Sequelize - part 1</a></p>
<h2>Learning Objectives</h2>
<p>Understand how to add Sequelize relationships to represent FOREIGN KEY constraints.</p>
<h2>Lesson</h2>
<p>To connect tables in Sequelize your model definitions simply need to specify their relationships using the <code>hasMany</code> or <code>belongsTo</code> functions. For example, we simply add the following 2 lines to the Restaurant class:</p>
<pre><code class="language-javascript">Restaurant.hasMany(Menu, {<span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;menus&#x27;</span>, <span class="hljs-attr">foreignKey</span>: <span class="hljs-string">&#x27;restaurant_id&#x27;</span>})
Menu.belongsTo(Restaurant, {<span class="hljs-attr">foreignKey</span>: <span class="hljs-string">&#x27;restaurant_id&#x27;</span>})
</code></pre>
<p>Sequelize will do all the hard work of creating the new foreign key columns!</p>
<p>We can test the relationships have been setup correctly using the following code:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> {sequelize} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./sequelize_index&#x27;</span>);
<span class="hljs-keyword">const</span> {Restaurant} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./Restaurant&#x27;</span>);
<span class="hljs-keyword">const</span> {Menu} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./Menu&#x27;</span>);
<span class="hljs-keyword">const</span> {MenuItem} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./MenuItem&#x27;</span>)


describe(<span class="hljs-string">&#x27;Relationships&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">await</span> sequelize.sync({ <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> });
    })
    
    test(<span class="hljs-string">&#x27;restaurants have menus&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">const</span> restaurant = <span class="hljs-keyword">await</span> Restaurant.create({<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ronalds&#x27;</span>, <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;http://some.image.url&#x27;</span>})
        <span class="hljs-keyword">const</span> menu = <span class="hljs-keyword">await</span> Menu.create({<span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;set 1&#x27;</span>});
        <span class="hljs-keyword">await</span> restaurant.addMenu(menu);
        <span class="hljs-keyword">const</span> menus = <span class="hljs-keyword">await</span> restaurant.getMenus();
        <span class="hljs-keyword">const</span> menuItem = <span class="hljs-keyword">await</span> MenuItem.create({<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;egg&#x27;</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">2.00</span>});
        <span class="hljs-keyword">await</span> menus[<span class="hljs-number">0</span>].addMenuItem(menuItem);
        <span class="hljs-keyword">const</span> menuItems = <span class="hljs-keyword">await</span> menus[<span class="hljs-number">0</span>].getMenuItems();

        expect(menuItems.length).toBe(<span class="hljs-number">1</span>);

        expect(menus[<span class="hljs-number">0</span>].title).toBe(<span class="hljs-string">&#x27;set 1&#x27;</span>);
    })

})
</code></pre>
<p>Note that the Sequelize library is build using promises, so we can use async await in our code.</p>
<h2>Assignment</h2>
<ul>
<li>Configure the relationships between the Restaurant, Menu and Menu Item model classes</li>
<li>Write unit tests that prove your relationships are all correctly connected</li>
<li>Commit your code into Github and share the link with your coach for review</li>
</ul>
<h2>Assignment extention tasks</h2>
<p>Look at ORMs for other languages such as <a href="https://docs.microsoft.com/en-us/ef/core/get-started/overview/first-app?tabs=netcore-cli">Entity Framework Core for .NET</a> and <a href="https://spring.io/guides/gs/accessing-data-jpa/">Spring JPA for Java</a>. Do you see any similarities to Sequelize?</p>
<h2>Additional resources</h2>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
    </body>
</html>