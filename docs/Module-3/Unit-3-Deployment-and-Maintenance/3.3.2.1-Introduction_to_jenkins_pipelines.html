<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="utf-8">
    <title>
         Introduction to Jenkins Pipelines
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
    <link rel="stylesheet" href="/curriculum/style.css" />
    <script src="/curriculum/js/highlight.min.js"></script>
    <script src="/curriculum/js/bash.min.js"></script>
    <script src="/curriculum/js/java.min.js"></script>
    <script src="/curriculum/js/javascript.min.js"></script>
    <script src="/curriculum/js/sql.min.js"></script>
</head>

<body>
    <button id="navigation-toggle" aria-expanded="false" aria-haspopup="true" onclick="toggleNav()"
        onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}" tabindex="1">Table of contents</button>
    <nav id="navigation"><ul><details><summary>Bootcamp</summary><ul><details><summary>Unit 1 Object Oriented Programming</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.0-UML_Modelling.html">0.1.0 UML Modelling</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.2-Objects_in_an_Airport_Domain.html">0.1.2 Objects in an Airport Domain</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.3-Test_Driven_Development.html">0.1.3 Test Driven Development</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.7-OOP_Challenge.html">0.1.7 OOP Challenge</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.8-End_of_Unit_Quiz_OOP.html">0.1.8 End of Unit Quiz OOP</a></li></ul></details><details><summary>Unit 2 Asynchronous JavaScript</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.1-Asynchronous_JavaScript.html">0.2.1 Asynchronous JavaScript</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.2-Promises.html">0.2.2 Promises</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.3-Asynchronous_Airport_Data_Load.html">0.2.3 Asynchronous Airport Data Load</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.4-End_of_Unit_Quiz_Async.html">0.2.4 End of Unit Quiz Async</a></li></ul></details><details><summary>Unit 3 Relational Databases</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.2-Introduction_to_Databases.html">0.3.2 Introduction to Databases</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.3-Basic_SQL_Commands.html">0.3.3 Basic SQL Commands</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.4-SQL_Joins.html">0.3.4 SQL Joins</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.5-Programmatic_Database_Access.html">0.3.5 Programmatic Database Access</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.6-Populating_databases_from_JSON.html">0.3.6 Populating databases from JSON</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.7-Object_Relational_Mapping_part_1.html">0.3.7 Object Relational Mapping part 1</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.8-Object_Relational_Mapping_part_2.html">0.3.8 Object Relational Mapping part 2</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.9a-Commercial_ORM_part_1.html">0.3.9a Commercial ORM part 1</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.9b-Commercial_ORM_part_2.html">0.3.9b Commercial ORM part 2</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.9c-End_of_Unit_Quiz_Databases.html">0.3.9c End of Unit Quiz Databases</a></li></ul></details><details><summary>Unit 4 RESTful Servers</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.1-Web_Servers.html">0.4.1 Web Servers</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.2-Application_Servers.html">0.4.2 Application Servers</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.3-Postman.html">0.4.3 Postman</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.4-Route_Parameters.html">0.4.4 Route Parameters</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.5-CRUD_operations.html">0.4.5 CRUD operations</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.6-Server_side_Validation.html">0.4.6 Server side Validation</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.7-End_of_Unit_Quiz_RESTful.html">0.4.7 End of Unit Quiz RESTful</a></li></ul></details><details><summary>Unit 5 Human Computer Interaction</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.1-Human_Computer_Interaction.html">0.5.1 Human Computer Interaction</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.3-The_Document_Object_Model.html">0.5.3 The Document Object Model</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.4-HTML_forms_and_lists.html">0.5.4 HTML forms and lists</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.4.1-Component_update_cycle.html">0.5.4.1 Component update cycle</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.5-End_of_Unit_Quiz_HCI.html">0.5.5 End of Unit Quiz HCI</a></li></ul></details><details><summary>Unit 6 End Of Bootcamp Group Project</summary><ul><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.1-Introduction.html">0.6.1 Introduction</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.2-Requirements.html">0.6.2 Requirements</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.3-Agile_Development.html">0.6.3 Agile Development</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.4-Design.html">0.6.4 Design</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.5-GitHub_Projects.html">0.6.5 GitHub Projects</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.6-Branching_and_Pull_Requests.html">0.6.6 Branching and Pull Requests</a></li><li><a class="nav-link" href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.7-Deployment_with_Heroku.html">0.6.7 Deployment with Heroku</a></li></ul></details></ul></details><details><summary>Module 1</summary><ul><details><summary>Unit 1 Agile user requirements</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-1-Agile_user_requirements/1.1.1-Introduction_to_Agile.html">1.1.1 Introduction to Agile</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-1-Agile_user_requirements/1.1.2-Personas.html">1.1.2 Personas</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-1-Agile_user_requirements/1.1.3-Requirements.html">1.1.3 Requirements</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-1-Agile_user_requirements/1.1.4-User_Stories.html">1.1.4 User Stories</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-1-Agile_user_requirements/1.1.5-Next_Steps.html">1.1.5 Next Steps</a></li></ul></details><details><summary>Unit 2 Designing UI</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-2-Designing_UI/1.2.1-Usability_heuristics.html">1.2.1 Usability heuristics</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-2-Designing_UI/1.2.2-Composition_and_components_in_design.html">1.2.2 Composition and components in design</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-2-Designing_UI/1.2.3-Prototyping_UI.html">1.2.3 Prototyping UI</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-2-Designing_UI/1.2.4-Next_Steps.html">1.2.4 Next Steps</a></li></ul></details><details><summary>Unit 3 Building UI with React</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.0-Welcome_to_Unit_3.html">1.3.0 Welcome to Unit 3</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.1-Getting_started_with_React.html">1.3.1 Getting started with React</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.2-React_methods_and_computed_properties.html">1.3.2 React methods and computed properties</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.3-Events_and_adding_to_cart.html">1.3.3 Events and adding to cart</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.4-Introducing_routing_to_our_app.html">1.3.4 Introducing routing to our app</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.5-Fixing_the_add_to_cart_event.html">1.3.5 Fixing the add to cart event</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.6-Adding_the_product_details_page.html">1.3.6 Adding the product details page</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.7-Integrating_Redux_for_global_state_management.html">1.3.7 Integrating Redux for global state management</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.8-Consolidating_the_final_components.html">1.3.8 Consolidating the final components</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_React/1.3.9-Closing_thoughts_and_next_steps.html">1.3.9 Closing thoughts and next steps</a></li></ul></details><details><summary>Unit 3 Building UI with Vue.js</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.0-Welcome_to_Unit_3.html">1.3.0 Welcome to Unit 3</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.1-Getting_started_with_the_Vue_CDN.html">1.3.1 Getting started with the Vue CDN</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.2-Vue_methods_and_computed_properties.html">1.3.2 Vue methods and computed properties</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.3-Events_and_adding_to_cart.html">1.3.3 Events and adding to cart</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.4-Introducing_routing_to_our_app.html">1.3.4 Introducing routing to our app</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.5-Fixing_the_add_to_cart_event.html">1.3.5 Fixing the add to cart event</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.6-Adding_the_product_details_page.html">1.3.6 Adding the product details page</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.7-Integrating_Vuex_for_global_state_management.html">1.3.7 Integrating Vuex for global state management</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.8-Consolidating_the_final_components.html">1.3.8 Consolidating the final components</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-3-Building_UI_with_Vue.js/1.3.9-Closing_thoughts_and_next_steps.html">1.3.9 Closing thoughts and next steps</a></li></ul></details><details><summary>Unit 4 Accessibility</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-4-Accessibility/1.4.1-Inclusive_design.html">1.4.1 Inclusive design</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-4-Accessibility/1.4.2-Accessibility.html">1.4.2 Accessibility</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-4-Accessibility/1.4.3-Next_Steps.html">1.4.3 Next Steps</a></li></ul></details><details><summary>Unit 5 End to end testing</summary><ul><li><a class="nav-link" href="/curriculum/Module-1/Unit-5-End_to_end_testing/1.5.1-End_to_end_testing.html">1.5.1 End to end testing</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-5-End_to_end_testing/1.5.2-End_to_end_testing_with_Cypress.html">1.5.2 End to end testing with Cypress</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-5-End_to_end_testing/1.5.3-Adding_more_test_coverage.html">1.5.3 Adding more test coverage</a></li><li><a class="nav-link" href="/curriculum/Module-1/Unit-5-End_to_end_testing/1.5.4-Test_cases_and_equivalence_testing.html">1.5.4 Test cases and equivalence testing</a></li></ul></details></ul></details><details><summary>Module 2</summary><ul><details><summary>Unit 1 Securing APIs with Basic Auth</summary><ul><li><a class="nav-link" href="/curriculum/Module-2/Unit-1-Securing_APIs_with_Basic_Auth/2.1.1-RESTful_APIs_and_Frameworks.html">2.1.1 RESTful APIs and Frameworks</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-1-Securing_APIs_with_Basic_Auth/2.1.2-Password_Hashing.html">2.1.2 Password Hashing</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-1-Securing_APIs_with_Basic_Auth/2.1.3-Implementing_Basic_Auth.html">2.1.3 Implementing Basic Auth</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-1-Securing_APIs_with_Basic_Auth/2.1.4-Limitations_of_Basic_Auth.html">2.1.4 Limitations of Basic Auth</a></li></ul></details><details><summary>Unit 2 Securing APIs with OAuth and OpenID Connect</summary><ul><li><a class="nav-link" href="/curriculum/Module-2/Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect/2.2.1-Introduction_to_OAuth.html">2.2.1 Introduction to OAuth</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect/2.2.2-Securing_APIs_with_OAuth.html">2.2.2 Securing APIs with OAuth</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect/2.2.3-OpenID_Connect.html">2.2.3 OpenID Connect</a></li><li><a class="nav-link" href="/curriculum/Module-2/Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect/2.2.4-Module_2_assessment.html">2.2.4 Module 2 assessment</a></li></ul></details></ul></details><details><summary>Module 3</summary><ul><details><summary>Unit 1 The SDLC</summary><ul><li><a class="nav-link" href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.0-Introduction_to_module_3.html">3.1.0 Introduction to module 3</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.1-The_Software_Development_Life_Cycle.html">3.1.1 The Software Development Life Cycle</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.2-The_roles_and_responsibilities_in_the_SDLC.html">3.1.2 The roles and responsibilities in the SDLC</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.3-Communication_in_your_teams.html">3.1.3 Communication in your teams</a></li></ul></details><details><summary>Unit 2 The 7 Princibles of Testing</summary><ul><li><a class="nav-link" href="/curriculum/Module-3/Unit-2-The-7-Princibles-of-Testing/3.2.1-The_7_Princibles_of_Testing.html">3.2.1 The 7 Princibles of Testing</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-2-The-7-Princibles-of-Testing/3.2.2-Continuous_Deployment.html">3.2.2 Continuous Deployment</a></li></ul></details><details><summary>Unit 3 Deployment and Maintenance</summary><ul><li><a class="nav-link" href="/curriculum/Module-3/Unit-3-Deployment-and-Maintenance/3.3.1-Introduction_to_Unix.html">3.3.1 Introduction to Unix</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-3-Deployment-and-Maintenance/3.3.2-Introduction_to_containerisation.html">3.3.2 Introduction to containerisation</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-3-Deployment-and-Maintenance/3.3.2.1-Introduction_to_jenkins_pipelines.html">3.3.2.1 Introduction to jenkins pipelines</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-3-Deployment-and-Maintenance/3.3.3-Introduction_to_Cloud_Computing.html">3.3.3 Introduction to Cloud Computing</a></li><li><a class="nav-link" href="/curriculum/Module-3/Unit-3-Deployment-and-Maintenance/3.3.4-Monitoring_and_Maintenance.html">3.3.4 Monitoring and Maintenance</a></li></ul></details></ul></details><details><summary>Module 4</summary><ul><details><summary>Unit 1 Open Web Application Security Project</summary><ul><li><a class="nav-link" href="/curriculum/Module-4/Unit-1-Open_Web_Application_Security_Project/4.1.1-OWASP.html">4.1.1 OWASP</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-1-Open_Web_Application_Security_Project/4.1.2-Juice_Shop.html">4.1.2 Juice Shop</a></li></ul></details><details><summary>Unit 2 OWASP Top 10</summary><ul><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.1-Broken_Access_Control.html">4.2.1 Broken Access Control</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.2-Cryptographic_Failure.html">4.2.2 Cryptographic Failure</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.3-Injection.html">4.2.3 Injection</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.4-Insecure_Design.html">4.2.4 Insecure Design</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.5-Security_Misconfiguration.html">4.2.5 Security Misconfiguration</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.6-Vulnerable_Components.html">4.2.6 Vulnerable Components</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.7-Identification_and_Authentication_Failures.html">4.2.7 Identification and Authentication Failures</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.8-Software_and_Data_Integrity_Failures.html">4.2.8 Software and Data Integrity Failures</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.9-Security_Logging_and_Monitoring_Failures.html">4.2.9 Security Logging and Monitoring Failures</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-2-OWASP_Top_10/4.2.I0-Server_Side_Request_Forgery.html">4.2.I0 Server Side Request Forgery</a></li></ul></details><details><summary>Unit 3 OWASP Assignments</summary><ul><li><a class="nav-link" href="/curriculum/Module-4/Unit-3-OWASP_Assignments/4.3.1-Portfolio.html">4.3.1 Portfolio</a></li><li><a class="nav-link" href="/curriculum/Module-4/Unit-3-OWASP_Assignments/4.3.2-Summative_Project.html">4.3.2 Summative Project</a></li></ul></details></ul></details></ul></nav>
    <h1>Introduction to Jenkins Pipelines</h1>
<p>Jenkins is a widely used platform for automating the process of integrating new changes into deployed code. It belongs to an area called CI/CD continuous integration or continuous deployment. The dream here is to automate the steps required to deploy code after updates or changes have been made.</p>
<p>❓ Why do you think senior developers are really keen on this kind of deployment?</p>
<p>For your apprenticeship there are some skills that you'll need to demonstrate related to this topic and they are:</p>
<p>S10: build, manage and deploy code into the relevant environment<br>
S11: apply an appropriate software development approach according to the relevant paradigm (jenkins piplines are event driven or procedural)<br>
S14: follow company, team or client approaches to continuous integration, version and source control</p>
<h2>Lets go!</h2>
<p>The aim of this workshop is to take a software project and deploy it into AWS. You will have completed the workshop challenge when you can make a change to the code base, push your changes and then without touching anything have your change propogate to the live version of your app running on AWS. This is called continuos deployment.</p>
<p><figure><img src="https://user-images.githubusercontent.com/4499581/216276344-f345e807-c554-4cd1-88f2-e5c1229011f5.png" alt="Screen shot of the mood tracker app"><figcaption></figcaption></figure></p>
<h3>Breaking down the steps</h3>
<p>The software project is here. Can you down load this unzip it and try to get it running locally.</p>
<p><a href="https://github.com/MultiverseLearningProducts/java-moodtracker-app/archive/refs/tags/1.0.0.zip">Moodtracker App</a></p>
<p>We are going to start by trying to execute the steps manually. This is helpful for us so we can make sure we have every credential, secret and setting correct before we automate the process.</p>
<ul>
<li>Put this project in your own bitbucket/source control</li>
<li>Run the app locally</li>
<li>Test the app using <code>gradle clean test</code></li>
<li>Build the app with <code>gradle bootJar</code></li>
<li>Dockerize the app <code>docker build -t ${your_docker_username}/moodtracker .</code></li>
<li>Push the image to DockerHub <code>docker push ${your_docker_username}/moodtracker</code></li>
<li>Create an EC2 instance and install docker (see below)</li>
<li>On the EC2 instance add a <code>docker-compose.yaml</code> file with the environmental variables ports etc</li>
<li>Pull and run the updated container via <code>docker compose up -d</code></li>
</ul>
<p>The environmental variables the app needs to be tested, built or run are:</p>
<pre><code><span class="hljs-attr">MOD2_AUTH0_CLIENT_ID</span>=•••••••••••••••••
<span class="hljs-attr">MOD2_AUTH0_CLIENT_SECRET</span>=•••••••••••••••••••••••••••••••••••••••••••••••••••
<span class="hljs-attr">MOD2_AUTH0_ISSUER</span>=•••••••••••••••••
</code></pre>
<p>Your coach can share these with you or you can set up your own Auth0 project.</p>
<h2>Automation with Jenkins</h2>
<p>We can run our own local instance of Jenkins. Below is a <code>docker-compose.yaml</code> that you can use. Update this with a path to keep all the Jenkins file somewhere on your file system. For this to work you have to have docker installed and running on your host machine.</p>
<pre><code class="language-yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">jenkins:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">jenkins</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">bmordan/jenkins-with-docker</span>
    <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">50000</span><span class="hljs-string">:50000</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${YOUR_PATH_ON_YOUR_FILE_SYSTEM}:/var/jenkins_home</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">jenkins</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">jenkins:</span>
</code></pre>
<p>Start the service with <code>docker compose up -d</code> visit <code>http://localhost:8080</code>. You will need the admin password which is in the container. You can access the password with the following docker command:</p>
<pre><code>docker exec jenkins cat <span class="hljs-regexp">/var/</span>jenkins_home<span class="hljs-regexp">/secrets/i</span>nitialAdminPassword
</code></pre>
<p>You can create an admin user and log in. Skip installing plugins (we will come back to that). What we are now looking at is an instance of Jenkins. We can use this to program automations of all kinds. It is a versatile and powerful platform with a plugin architecture. So if Jenkins doesn't yet do what you need it to, you can extend it by writing your own plugin.</p>
<p>Let's create our first pipeline.</p>
<ol>
<li>Go to add a new item -&gt; give it the name &quot;Hello World&quot; -&gt; Select 'Pipeline'</li>
<li>Scroll down to the <strong>Pipeline</strong> section select <strong>Pipeline script</strong></li>
<li>Add the code below</li>
<li>Save your pipeline and run it using <strong>Build Now</strong></li>
<li>You can see on the left the first build it will be called #1</li>
<li>Click on the build number and then select <strong>Console Output</strong></li>
</ol>
<pre><code class="language-groovy">pipeline {
    agent any
    stages {
        stage(<span class="hljs-string">&quot;Hello&quot;</span>) {
            steps {
                echo <span class="hljs-string">&quot;Hello World&quot;</span>
            }
        }
    }
}
</code></pre>
<p>There are 2 styles of Groovy scripting you might see. The declarative style (used above) or the plain script style which looks more like this:</p>
<pre><code class="language-groovy">node {
    <span class="hljs-comment">// commands</span>
}
</code></pre>
<p>Can you update the script to print out the working directory of the jenkins agent? You will need to update the script which you can access again in <strong>Configure</strong>.</p>
<pre><code>pipeline {
    agent <span class="hljs-built_in">any</span>
    stages {
        <span class="hljs-function"><span class="hljs-title">stage</span>(<span class="hljs-params"><span class="hljs-string">&quot;Hello&quot;</span></span>)</span> {
            steps {
                echo <span class="hljs-string">&quot;Hello World&quot;</span>
            }
        }
        <span class="hljs-function"><span class="hljs-title">stage</span>(<span class="hljs-params"><span class="hljs-string">&quot;PWD&quot;</span></span>)</span> {
            steps {
                sh <span class="hljs-string">&quot;pwd&quot;</span>
            }
        }
    }
}
</code></pre>
<p>Above you can see that we have added another stage, and we are executing shell commands in a linux environment, we are not on our own file system we are inside an agent.</p>
<p><figure><img src="https://miro.medium.com/max/1400/1*RXh0nHJm_NXWW9KidWOsNA.webp" alt="Jenkins Agents"><figcaption></figcaption></figure></p>
<p>Jenkins is central control. That is where we program pipelines, organise our pipelines and monitor them. The actual work of cloning repos, building apps etc is all done on agents. This are agent instances, they can be other nodes (other computers) and we can define them and what software they have installed upon them.</p>
<h2>Source Control Management</h2>
<p>The next step we want to take is being able to pull a project from source control and start to work with it. Can you create a pipeline that pulls the moodtracker project and lists all the files with the <code>ls -l</code> command.</p>
<p>For Jenkins to pull and push to your repo it will need your bitbucket logins. You can avoid using your bit bucket password by generating an access token. If you goto your personal setting, you will see <strong>App passwords</strong> You can create one for Jenkins. Add your credentials to Jenkins:</p>
<p>Dashboard -&gt; Manage Jenkins -&gt; Manage Credentials -&gt; System -&gt; Global credentials (unrestricted) -&gt; + Add Credentials -&gt; Username with Password</p>
<p>Now try to use them in a pipeline script</p>
<pre><code class="language-groovy">pipeline {
    agent any
    stages {
        stage(<span class="hljs-string">&quot;clone&quot;</span>) {
            steps {
                git <span class="hljs-attr">credentialsId:</span> <span class="hljs-string">&#x27;YOUR_ID&#x27;</span>, <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://bitbucket.org/bernardmordan/spring-oauth-example/src/master/&#x27;</span>
                sh <span class="hljs-string">&#x27;ls -l&#x27;</span>
            }
        }
    }
}
</code></pre>
<p>Can you check out a branch? What happens if you try to run the tests with <code>gradle test</code>?</p>
<h2>Agents with tools in them</h2>
<p>It's likely your pipeline now FAILS with gradle: not found. We need the gradle tool to test and build our app. There are 2 ways to approach this:</p>
<ol>
<li>Configure the global tools on the Jenkins server</li>
<li>Use a docker image with gradle installed within it as our agent</li>
</ol>
<p>To configure the global gradle.</p>
<ol>
<li>Install the gradle plugin</li>
<li>Goto Dashboard -&gt; Manage Jenkins -&gt; Global Tool Configuration -&gt; Gradle installations...</li>
</ol>
<p>Add gradle give it a name/label and select the version you want to have installed. You can have different versions installed a select then via there name or label.<br>
Save your changes. I called my install <strong>Gradle 8</strong>.</p>
<p>Now in your pipeline script you can declare at the pipeline or stage level that you want the gradle tool available. Like this</p>
<pre><code class="language-groovy">pipeline {
    agent any
    tools {
        gradle <span class="hljs-string">&#x27;Gradle 8&#x27;</span>
    }
    environment {
        MOD2_AUTH0_CLIENT_ID = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_ID&quot;</span>)
        MOD2_AUTH0_CLIENT_SECRET = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_SECRET&quot;</span>)
        MOD2_AUTH0_ISSUER = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_ISSUER&quot;</span>)
    }
    stages {
        stage(<span class="hljs-string">&quot;hello-github&quot;</span>) {
            steps {
                git <span class="hljs-attr">credentialsId:</span> <span class="hljs-string">&#x27;github&#x27;</span>, <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://github.com/MultiverseLearningProducts/java-moodtracker-app&#x27;</span>
                sh <span class="hljs-string">&#x27;java --version&#x27;</span>
                sh <span class="hljs-string">&#x27;gradle --version&#x27;</span>
            }
        }
        stage(<span class="hljs-string">&quot;Test&quot;</span>) {
            steps {
                sh <span class="hljs-string">&#x27;gradle clean test&#x27;</span>
            }
        }
    }
}
</code></pre>
<p>Can you see I am using environmental variables in the set up for the pipeline. The application needs these to run integration tests and to build the app. You can add these in Dashboard -&gt; Manage Jenkins -&gt; Manage Credentials -&gt; System -&gt; Global credentials (unrestricted) -&gt; + Add Credentials -&gt; Secret text the ID would be something like <strong>MOD2_AUTH0_ISSUER</strong> as above. Once these are created you can access them in your pipelines as we are doing so above.</p>
<p>That might not work...</p>
<p>This project needs java 17, the jenkins server only has java 11 installed on it. We can install java 17 as well, but there is lots of futizing to get JAVA_HOME defined and it is easier to now try the other way of working with agents.</p>
<p>The second way to work with agents is to define a docker image you would like the pipeline or stage to run in. We want something with both gradle and java 17. Let's update our script to use a docker container:</p>
<p><em>Make sure you have the following plugins installed</em></p>
<ol>
<li>Pipeline: Declarative</li>
<li>Docker Pipeline</li>
<li>Docker API Plugin</li>
<li>Docker Commons Plugin</li>
<li>Docker Pipeline</li>
<li>Docker Plugin</li>
<li>docker-build-step</li>
</ol>
<pre><code class="language-groovy">pipeline {
    agent {
        docker {
            image <span class="hljs-string">&#x27;gradle:7.6.0-jdk17&#x27;</span>
        }
    }
    environment {
        MOD2_AUTH0_CLIENT_ID = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_ID&quot;</span>)
        MOD2_AUTH0_CLIENT_SECRET = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_SECRET&quot;</span>)
        MOD2_AUTH0_ISSUER = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_ISSUER&quot;</span>)
    }
    stages {
        stage(<span class="hljs-string">&quot;hello-github&quot;</span>) {
            steps {
                git <span class="hljs-attr">credentialsId:</span> <span class="hljs-string">&#x27;github&#x27;</span>, <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://github.com/MultiverseLearningProducts/java-moodtracker-app&#x27;</span>
                sh <span class="hljs-string">&#x27;java --version&#x27;</span>
                sh <span class="hljs-string">&#x27;gradle --version&#x27;</span>
            }
        }
        stage(<span class="hljs-string">&quot;Test&quot;</span>) {
            steps {
                sh <span class="hljs-string">&#x27;gradle clean test&#x27;</span>
                sh <span class="hljs-string">&#x27;gradle bootJar&#x27;</span>
            }
        }
    }
}
</code></pre>
<p>This is quite a moment. What a powerful tool we now have to automate workflows. Can you now build out the pipeline to clone, test and build the project? We want to end up with access to the .jar file for the project. Try ending your pipeline with this command:</p>
<pre><code class="language-sh">sh <span class="hljs-string">&#x27;ls -l build/libs/*.jar&#x27;</span>
</code></pre>
<h2>Provision AWS</h2>
<p>You will need an AWS account. Log into the developer console and follow the steps to create a new instance. Make sure you know where the <code>.pem</code> file is once it is downloaded. Make a note of the public ip address.</p>
<ol>
<li>install docker onto the instance</li>
<li>open port 8080 in the security section</li>
<li>create a docker-compose to run the container with secrets</li>
</ol>
<p>To install docker on EC2 use the commands below once you have ssh into the machine. I find you usually have to restart the instance to get docker working ok.</p>
<pre><code class="language-sh">sudo amazon-linux-extras install docker
sudo service docker start
sudo usermod -a -G docker ec2-user
sudo chkconfig docker on
sudo curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/<span class="hljs-built_in">local</span>/bin/docker-compose
sudo chmod +x /usr/<span class="hljs-built_in">local</span>/bin/docker-compose
sudo reboot
</code></pre>
<pre><code class="language-yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">moodtracker:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">moodtracker</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">bmordan/moodtracker</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MOD2_AUTH0_CLIENT_ID=•••••••••••••••••</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MOD2_AUTH0_CLIENT_SECRET=•••••••••••••••••</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MOD2_AUTH0_ISSUER=•••••••••••••••••</span>
</code></pre>
<p>Change <code>bmordan/moodtracker</code> to the name of your docker container. Try and run moodtracker on your EC2 instance. You don't have to use docker compose file you can use the docker run command based on the following example.</p>
<pre><code><span class="hljs-attribute">docker</span> run -e MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_CLIENT_ID=$MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_CLIENT_ID -e MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_CLIENT_SECRET=$MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_CLIENT_SECRET -e MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_ISSUER=$MOD<span class="hljs-number">2</span>_AUTH<span class="hljs-number">0</span>_ISSUER --name=moodtracker -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -d bmordan/moodtracker
</code></pre>
<p>Now if you visit <code>http://your-ec2-addr.amazon.com</code> you should see the login button. We'll not be able to login without updating the allowed redirect_uri in our Auth0 applications settings page on Auth0 site.</p>
<h2>Dockerize the app</h2>
<p>So far on Jenkins we can test and build the moodtracker app. Now we want to take that jar file, wrap it in a docker container that has jdk17 and have the launch command set so when the container starts our app starts on port 8080.</p>
<p>Can you have a go at making the Dockerfile?</p>
<p>Push your image to docker hub. Now we want to automate that stage of deployment. We will have to review the pipeline. The first part of the pipeline needs gradle and java 17 but not docker, the second part of the pipeline needs docker, but not gradle and java 17. We can split the pipeline up and use different agents for the different sections.</p>
<p><figure><img src="https://user-images.githubusercontent.com/4499581/219146495-52dec7f1-d968-4373-9192-2431074a7671.png" alt="visualisation of the different agents in a pipeline"><figcaption></figcaption></figure></p>
<p>Update your pipeline to not declare a global agent. Now you have to declare the kind of agent you want to run each stage.</p>
<pre><code class="language-groovy">pipeline {
    agent none
    environment {
        MOD2_AUTH0_CLIENT_ID = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_ID&quot;</span>)
        MOD2_AUTH0_CLIENT_SECRET = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_CLIENT_SECRET&quot;</span>)
        MOD2_AUTH0_ISSUER = credentials(<span class="hljs-string">&quot;MOD2_AUTH0_ISSUER&quot;</span>)
        DOCKER = credentials(<span class="hljs-string">&quot;DOCKER_CREDENTIALS&quot;</span>)
    }
    stages {
        stage(<span class="hljs-string">&quot;Test&quot;</span>) {
            agent {
                docker {
                    image <span class="hljs-string">&#x27;gradle:7.6.0-jdk17&#x27;</span>
                }
            }
            steps {
                sh <span class="hljs-string">&#x27;gradle clean test&#x27;</span>
                sh <span class="hljs-string">&#x27;gradle bootJar&#x27;</span>
            }
        }
        stage(<span class="hljs-string">&quot;Dockerize&quot;</span>) {
            agent {
                docker {
                    image <span class="hljs-string">&#x27;docker:dind&#x27;</span>
                }
            }
            steps {
                script {
                    image = docker.build(<span class="hljs-string">&#x27;bmordan/moodtracker&#x27;</span>)
                    sh <span class="hljs-string">&#x27;echo $DOCKER_PSW | docker login -u $DOCKER_USR --password-stdin&#x27;</span>
                    sh <span class="hljs-string">&#x27;docker push bmordan/moodtracker&#x27;</span>
                    sh <span class="hljs-string">&#x27;docker logout&#x27;</span>
                }
            }
        }
    }
}
</code></pre>
<p>You will have to add your docker credentials to your Jenkins instance. You can obtain a docker access token in place of using your docker hub password (profile -&gt; Account Settings -&gt; Security -&gt; Access Tokens). In the Dockerize stage we are using the &quot;Docker in Docker&quot; or <code>docker:dind</code> image to run docker commands to build the image for our jar file and then push it to docker hub.</p>
<h2>ssh and final steps</h2>
<p>Now we are ready to connect to our AWS machine and pull the image. You will need to add your <code>?.pem</code> file to Jenkins. Goto the manage credientials section and add the contents of your <code>.pem</code> file to <strong>SSH Username with private key</strong>. Add your key's text, the username will be <strong>ec2-user</strong>, give this credential an ID like <strong>AWS_PEM_KEY</strong>. Now you are ready to implement the final step.</p>
<pre><code class="language-groovy">stage(<span class="hljs-string">&quot;Deploy&quot;</span>) {
    agent any
    steps {
        sshagent(<span class="hljs-attr">credentials:</span> [<span class="hljs-string">&quot;AWS_PEM_KEY&quot;</span>]) {
            sh <span class="hljs-string">&quot;ssh -o StrictHostKeyChecking=no ec2-user@your-ec2-instance-ip &#x27;docker pull bmordan/moodtracker&#x27;&quot;</span>
            sh <span class="hljs-string">&quot;ssh -o StrictHostKeyChecking=no ec2-user@your-ec2-instance-ip &#x27;docker stop moodtracker || true &amp;&amp; docker rm moodtracker || true&#x27;&quot;</span>
            sh <span class="hljs-string">&quot;ssh -o StrictHostKeyChecking=no ec2-user@your-ec2-instance-ip &#x27;docker run -e MOD2_AUTH0_CLIENT_ID=$MOD2_AUTH0_CLIENT_ID -e MOD2_AUTH0_CLIENT_SECRET=$MOD2_AUTH0_CLIENT_SECRET -e MOD2_AUTH0_ISSUER=$MOD2_AUTH0_ISSUER --name=moodtracker -p 8080:8080 -d bmordan/moodtracker&#x27;&quot;</span>
        }
    }
}
</code></pre>
<p>Now when you make changes and push to version control your pipeline can test, build, containerize and deploy your moodtracker app.</p>
<p>This final section is useful introduction to setting up https so you have a secure encrypted site. Without https data in requests are in plain text and anyone can intercept your http request and read it. So passing passwords or other data over http is not secure.</p>
<h2>HTTPS</h2>
<p>This will feel fiddly because it is. We are going to do the following.</p>
<ol>
<li>We will need to set up a domain name that uses DNS records</li>
<li>Install a web server on our ec2 instance</li>
<li>Install a cert bot to deal with fetching a valid SSL certificate</li>
<li>We need to provision our ec2 instance to forward external web traffic from port 80 to port 8080 which is called setting up a proxy</li>
</ol>
<h3>Set up a domain</h3>
<p>If you look at a service like https://www.godaddy.com/en-uk or https://www.gandi.net/en-GB you should be able to purchase a domain name for a few pounds. For example, I bought bernardmordan.dev for £2.95 - you don't need to spend more than the price of a coffee, see what you can get, it can be anything i.e. rhubarb-bikini.shop is £0.96.</p>
<p>In your DNS management console you need to find your <strong>A record</strong> and point this domain at your ec2 using your ec2 ip address. My <strong>A record</strong> looks like this.</p>
<p><figure><img src="https://user-images.githubusercontent.com/4499581/219157070-05d57c4c-0a67-49e3-80d9-3a4742156e47.png" alt="DNS A records"><figcaption></figcaption></figure></p>
<p>The TTL is the time it takes to update and have your new setting working. It can take many hours. You can see the ip address <code>13.42.55.28</code> that is from my ec2 instance.</p>
<h3>Install Apache</h3>
<p>This is a web server there are other options like Nginx which work in a very similar way. Run the following commands one at a time</p>
<pre><code>sudo yum install -y httpd
sudo systemctl <span class="hljs-keyword">start</span> httpd
sudo systemctl <span class="hljs-keyword">enable</span> httpd
</code></pre>
<p>To check all is set up visit <code>http://my.ip.addr.here</code> you should see the Apache test page. Notice the <code>http://</code> nothing will show if you request via <code>https://</code> that is what we are working on now.</p>
<p><figure><img src="https://docs.aws.amazon.com/images/AWSEC2/latest/UserGuide/images/apache_test_page_al2_2.4.png" alt="Apache web server test page"><figcaption></figcaption></figure></p>
<p>You can now put static assets into <code>/var/www/html/</code> folder and they will be served at your host address <code>http://my.ip.addr.here</code>. Add your ec2 user to the apache group.</p>
<pre><code class="language-sh">sudo usermod -a -G apache ec2-user
</code></pre>
<p>Log out and log back in again to pick up the group <code>exit</code> -&gt; reconnect with your ssh command. Change the group ownership of <code>/var/www</code> and its contents and future contents to the apache group.</p>
<pre><code>sudo chown -R ec2-user:apache <span class="hljs-regexp">/var/</span>www
sudo chmod <span class="hljs-number">2775</span> <span class="hljs-regexp">/var/</span>www &amp;&amp; <span class="hljs-keyword">find</span> <span class="hljs-regexp">/var/</span>www -type d -exec sudo chmod <span class="hljs-number">2775</span> {} \;
<span class="hljs-keyword">find</span> <span class="hljs-regexp">/var/</span>www -type f -exec sudo chmod <span class="hljs-number">0664</span> {} \;
</code></pre>
<h3>Certbot</h3>
<p>Goto your ec2 security tab and open up port 443. You can close port 8080.</p>
<pre><code>sudo amazon-linux-<span class="hljs-keyword">extras </span><span class="hljs-keyword">install </span>epel -y
sudo yum <span class="hljs-keyword">install </span>-y certbot python2-certbot-apache
sudo certbot
</code></pre>
<p>Follow the prompts - get your certs installed. Open <code>/etc/crontab</code> and add the cron job (twice daily cert checking):</p>
<pre><code><span class="hljs-symbol">39 </span>     <span class="hljs-number">1</span>,<span class="hljs-number">13</span>    *       *       *       root    certbot renew --no-self-upgrade
</code></pre>
<p>Then restart the cron daemon <code>sudo systemctl restart crond</code>. Cron is a task schedule tool to set a script to run on a regular basis. Its like setting a daily alarm clock to wake you up every day at 07:10. Or in our case check our certs are not out of date every day at 13:13.</p>
<p>Certbot is a small python script that automates the dance of requesting a certificate from the <a href="https://letsencrypt.org/">letsencrypt</a> service. It saves the certs on the ec2 instance and updates some of your Apache config. When traffic now enters and leaves your web server it <em>can</em> be encrypted using these keys and certificates.</p>
<h3>Proxy requests from port 80 to 8080</h3>
<p>This is going to pass https traffic from port 80 (which has apache running on it) to port 8080 which has our moodtracker app running on it.</p>
<p>There are 3 files we need to edit. You can edit files on your ec2 instance using the <code>nano</code> command line editor.</p>
<ol>
<li><code>/etc/httpd/conf/httpd.conf</code></li>
<li><code>/etc/httpd/conf/httpd-le-ssl.conf</code></li>
<li><code>/etc/httpd/conf.d/ssl.conf</code></li>
</ol>
<p>In <code>/etc/httpd/conf/httpd.conf</code> update the VirtualHost definition to this</p>
<pre><code><span class="hljs-attribute"><span class="hljs-nomarkup">Listen</span></span> <span class="hljs-number">80</span>
<span class="hljs-section">&lt;VirtualHost *<span class="hljs-number">:80</span>&gt;</span>
    <span class="hljs-attribute">ProxyPreserveHost</span> <span class="hljs-literal">On</span>
    <span class="hljs-attribute">ProxyRequests</span> <span class="hljs-literal">Off</span>
    <span class="hljs-attribute"><span class="hljs-nomarkup">DocumentRoot</span></span> <span class="hljs-string">&quot;/var/www/html&quot;</span>
    <span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span> <span class="hljs-string">&quot;example.com&quot;</span>
    <span class="hljs-attribute">ServerAlias</span> <span class="hljs-string">&quot;www.example.com&quot;</span>
    <span class="hljs-attribute">ProxyPass</span> / http://<span class="hljs-number">127.0.0.1:8080</span>/
    <span class="hljs-attribute">ProxyPassReverse</span> / https://<span class="hljs-number">127.0.0.1:8080</span>/
    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span> <span class="hljs-literal">on</span>
    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%{SERVER_NAME}</span> =www.example.com<span class="hljs-meta"> [OR]</span>
    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%{SERVER_NAME}</span> =example.com
    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> ^ https://<span class="hljs-variable">%{SERVER_NAME}</span><span class="hljs-variable">%{REQUEST_URI}</span><span class="hljs-meta"> [END,NE,R=permanent]</span>
<span class="hljs-section">&lt;/VirtualHost&gt;</span>
</code></pre>
<p>In <code>/etc/httpd/conf/httpd-le-ssl.conf</code> add similar config - notice this is for port <code>:443</code> which is the port dealing with encrypted https requests.</p>
<pre><code>&lt;VirtualHost *:<span class="hljs-number">443</span>&gt;
    DocumentRoot <span class="hljs-string">&quot;/var/www/html&quot;</span>
    ServerName <span class="hljs-string">&quot;example.com&quot;</span>
    ServerAlias <span class="hljs-string">&quot;www.example.com&quot;</span>
    SSLProxyEngine on
    ProxyPreserveHost On
    ProxyPass <span class="hljs-regexp">/ http:/</span><span class="hljs-regexp">/127.0.0.1:8080/</span>
    ProxyPassReverse <span class="hljs-regexp">/ https:/</span><span class="hljs-regexp">/127.0.0.1:8080/</span>
    <span class="hljs-keyword">Include</span> <span class="hljs-regexp">/etc/</span>letsencrypt/<span class="hljs-keyword">options</span>-ssl-apache.conf
    SSLCertificateFile <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>bernardmordan.dev/fullchain.pem
    SSLCertificateKeyFile <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>bernardmordan.dev/privkey.pem
&lt;/VirtualHost&gt;
</code></pre>
<p>In <code>/etc/httpd/conf.d/ssl.conf</code> just add <code>SSLProxyEngine on</code> the line below <code>SSLEngine on</code>.</p>
<p>Now you can update the redirect URLs on Auth0 and your moodtracking app should be provisioned and served over https.</p>
<h2>Next steps</h2>
<p>You have been introduced to Jenkins. You know about AWS. Can you take on this challenge?</p>
<p>Here are the files for a static site.<br>
https://github.com/bmordan/audio-grid-apprun (github repo)<br>
https://github.com/bmordan/audio-grid-apprun/archive/refs/tags/1.0.0.zip</p>
<p>Can you build a pipeline that deploys this site to an AWS S3 bucket? Setting up a S3 bucket as a static web host is quite straight forward, can you figure out how to clone the repo, then copy the files to the AWS bucket? Be really nice if this happened when you push to the repo (you will need to fork the repo to push code changes).</p>

    <nav id="footer-nav"></nav>
    <script src="/curriculum/js/tabbed-code-blocks.js"></script>
    <script>
        function toggleNav() {
            const button = document.getElementById('navigation-toggle')
            const isAriaExp = button.getAttribute('aria-expanded')
            const newAriaExp = (isAriaExp == "false") ? "true" : "false"
            button.setAttribute('aria-expanded', newAriaExp)
            const nav = document.getElementById('navigation')
            nav.style.display = nav.offsetParent ? 'none' : 'block'
        }
        function footerNav() {
            const links = document.getElementsByClassName('nav-link')
            const hrefs = Array.from(links).map(a => a.getAttribute('href'))
            const [current] = window.location.href.match(/[0-9\.]+[a-zA-Z0-9_\\-]+\.html/) || [0]
            const index = hrefs.findIndex(href => {
                const page = href.split(/\\|\//).pop()
                return page === current
            })
            const prevIndex = index - 1
            const nextIndex = index + 1
            if (prevIndex > -1) {
                const prev = document.createElement('a') 
                prev.appendChild(document.createTextNode("◀︎ Prev"))
                prev.title = "Previous session notes"
                prev.href = hrefs[prevIndex]
                document.getElementById('footer-nav').prepend(prev)
            }
            if (nextIndex < hrefs.length) {
                const next = document.createElement('a') 
                next.appendChild(document.createTextNode("Next ►"))
                next.title = "Next session notes"
                next.href = hrefs[nextIndex]
                document.getElementById('footer-nav').append(next)
            }
            window.removeEventListener('DOMContentLoaded', footerNav)
        }
        window.addEventListener('DOMContentLoaded', footerNav)
    </script>
</body>

</html>