<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Populating databases from JSON</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><details><summary>Bootcamp</summary><ul><details><summary>Unit 1 Object Oriented Programming</summary><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_And_Functions.html">0.1.1 JavaScript Objects And Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.6-UML_Modelling.html">0.1.6 UML Modelling</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.7-OOP_Challenge.html">0.1.7 OOP Challenge</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-End_of_Unit_Quiz_OOP.html">0.1.8 End of Unit Quiz OOP</a></li></ul></details><details><summary>Unit 2 Asynchronous JavaScript</summary><ul><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.1-Asynchronous_JavaScript.html">0.2.1 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.2-Promises.html">0.2.2 Promises</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.3-Asynchronous_Airport_Data_Load.html">0.2.3 Asynchronous Airport Data Load</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.4-End_of_Unit_Quiz_Async.html">0.2.4 End of Unit Quiz Async</a></li></ul></details><details><summary>Unit 3 Relational Databases</summary><ul><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.1-Logical_Data_Model.html">0.3.1 Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.10-Sequelize_part_2.html">0.3.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.11-End_of_Unit_Quiz_Databases.html">0.3.11 End of Unit Quiz Databases</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.2-Introduction_to_Databases.html">0.3.2 Introduction to Databases</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.3-Basic_SQL_Commands.html">0.3.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.4-SQL_Joins.html">0.3.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.5-Database_access_using_Node.html">0.3.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.6-Populating_databases_from_JSON.html">0.3.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.7-Object_Relational_Mapping_part_1.html">0.3.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.8-Object_Relational_Mapping_part_2.html">0.3.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.9-Sequelize_part_1.html">0.3.9 Sequelize part 1</a></li></ul></details><details><summary>Unit 4 RESTful Servers</summary><ul><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.1-Web_Servers.html">0.4.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.2-Application_Servers.html">0.4.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.3-Postman.html">0.4.3 Postman</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.4-Route_Parameters.html">0.4.4 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.5-CRUD_operations.html">0.4.5 CRUD operations</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.6-Server_side_Validation.html">0.4.6 Server side Validation</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.7-End_of_Unit_Quiz_RESTful.html">0.4.7 End of Unit Quiz RESTful</a></li></ul></details><details><summary>Unit 5 Human Computer Interaction</summary><ul><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.1-Human_Computer_Interaction.html">0.5.1 Human Computer Interaction</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.2-Server_Side_Rendering.html">0.5.2 Server Side Rendering</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.3-The_Document_Object_Model.html">0.5.3 The Document Object Model</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.4-HTML_forms_and_lists.html">0.5.4 HTML forms and lists</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.5-End_of_Unit_Quiz_HCI.html">0.5.5 End of Unit Quiz HCI</a></li></ul></details><details><summary>Unit 6 End Of Bootcamp Group Project</summary><ul><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.1-Introduction.html">0.6.1 Introduction</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.2-Requirements.html">0.6.2 Requirements</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.3-Agile_Development.html">0.6.3 Agile Development</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.4-Design.html">0.6.4 Design</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.5-GitHub_Projects.html">0.6.5 GitHub Projects</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.6-Branching_and_Pull_Requests.html">0.6.6 Branching and Pull Requests</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.7-Deployment_with_Heroku.html">0.6.7 Deployment with Heroku</a></li></ul></details></ul></details><details><summary>Module 1</summary><ul><details><summary>Unit 1 Agile user requirements</summary><ul><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.1-Introduction_to_Agile.html">1.1.1 Introduction to Agile</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.2-Personas.html">1.1.2 Personas</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.3-User_Stories.html">1.1.3 User Stories</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.4-Requirements.html">1.1.4 Requirements</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.5-Next_Steps.html">1.1.5 Next Steps</a></li></ul></details><details><summary>Unit 2 Designing UI</summary><ul><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.1-Usability_heuristics.html">1.2.1 Usability heuristics</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.2-Composition_and_components_in_design.html">1.2.2 Composition and components in design</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.3-Prototyping_UI.html">1.2.3 Prototyping UI</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.4-Next_Steps.html">1.2.4 Next Steps</a></li></ul></details><details><summary>Unit 3 Building UI with a framework</summary><ul><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3-Welcome_to_unit_3.html">1.3 Welcome to unit 3</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.1-Part_1_Getting_started_with_the_Vue_CDN.html">1.3.1 Part 1 Getting started with the Vue CDN</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.2-Part_2_Vue_methods_and_computed_properties.html">1.3.2 Part 2 Vue methods and computed properties</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.3-Part_3_Events_and_Adding_to_cart.html">1.3.3 Part 3 Events and Adding to cart</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.4-Part_4_Introducing_routing_to_our_app.html">1.3.4 Part 4 Introducing routing to our app</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.5-Part_5_Fixing_the_add_to_cart_event.html">1.3.5 Part 5 Fixing the add to cart event</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.6-Part_6_Adding_the_product_details_page.html">1.3.6 Part 6 Adding the product details page</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_a_framework\1.3.7-Part_7_Integrating_Vuex_for_global_state_management.html">1.3.7 Part 7 Integrating Vuex for global state management</a></li></ul></details><details><summary>Unit 4 Accessibility</summary><ul><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.1-Inclusive_design.html">1.4.1 Inclusive design</a></li><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.2-Accessibility.html">1.4.2 Accessibility</a></li><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.3-Next_Steps.html">1.4.3 Next Steps</a></li></ul></details><details><summary>Unit 5 End to end testing</summary><ul><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.1-End_to_end_testing.html">1.5.1 End to end testing</a></li><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.2-Test_cases_and_equivalence_testing.html">1.5.2 Test cases and equivalence testing</a></li></ul></details></ul></details><details><summary>Module 2</summary><ul><details><summary>Unit 1 Securing RESTful APIs</summary><ul><li><a href="/curriculum\Module-2\Unit-1-Securing_RESTful_APIs\2.1.1-Designing_RESTful_APIs.html">2.1.1 Designing RESTful APIs</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_RESTful_APIs\2.1.2-What_makes_for_REST.html">2.1.2 What makes for REST</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_RESTful_APIs\2.1.3-Basic_Auth.html">2.1.3 Basic Auth</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_RESTful_APIs\2.1.4-Next_steps.html">2.1.4 Next steps</a></li></ul></details><details><summary>Unit 2 OAuth with OpenID Connect</summary><ul><li><a href="/curriculum\Module-2\Unit-2-OAuth_with_OpenID_Connect\2.2.1-Securing_with_OAuth.html">2.2.1 Securing with OAuth</a></li><li><a href="/curriculum\Module-2\Unit-2-OAuth_with_OpenID_Connect\2.2.2-Session_and_token_management.html">2.2.2 Session and token management</a></li><li><a href="/curriculum\Module-2\Unit-2-OAuth_with_OpenID_Connect\2.2.3-OpenID_Connect.html">2.2.3 OpenID Connect</a></li><li><a href="/curriculum\Module-2\Unit-2-OAuth_with_OpenID_Connect\2.2.4-API_Assignment.html">2.2.4 API Assignment</a></li></ul></details></ul></details><details><summary>Module 3</summary><ul><details><summary>Unit 1 The SDLC</summary><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-The_Software_Development_Life_Cycle.html">3.1.1 The Software Development Life Cycle</a></li><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.2-The_roles_and_responsibilities_in_the_SDLC_with_communication.html">3.1.2 The roles and responsibilities in the SDLC with communication</a></li><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.3-Communication_in_your_teams.html">3.1.3 Communication in your teams</a></li></ul></details><details><summary>Unit 2 The 7 Princibles of Testing</summary><ul><li><a href="/curriculum\Module-3\Unit-2-The-7-Princibles-of-Testing\3.2.1-The_7_Princibles_of_Testing.html">3.2.1 The 7 Princibles of Testing</a></li><li><a href="/curriculum\Module-3\Unit-2-The-7-Princibles-of-Testing\3.2.2-Continuous_Deployment.html">3.2.2 Continuous Deployment</a></li></ul></details><details><summary>Unit 3 Deployment and Maintenance</summary><ul><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.1-Containerisation_with_docker.html">3.3.1 Containerisation with docker</a></li><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.2-Introduction_to_Cloud_Computing.html">3.3.2 Introduction to Cloud Computing</a></li><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.3-Monitoring_and_Maintenance.html">3.3.3 Monitoring and Maintenance</a></li></ul></details></ul></details><details><summary>Module 4</summary><ul><details><summary>Unit 1 Open Web Application Security Project</summary><ul><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.1-Introduction_to_the_OWASP_Top_Ten.html">4.1.1 Introduction to the OWASP Top Ten</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.2-Injection_Attacks.html">4.1.2 Injection Attacks</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.3-Broken_Authentication.html">4.1.3 Broken Authentication</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.3-Exposing_Sensitive_Data.html">4.1.3 Exposing Sensitive Data</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.4-Monitoring_for_attacks.html">4.1.4 Monitoring for attacks</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.5-The_role_of_a_Penetration_Tester.html">4.1.5 The role of a Penetration Tester</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.6-Next_Steps.html">4.1.6 Next Steps</a></li></ul></details></ul></details></ul></nav>
        <h1>Populating databases from JSON</h1>
<h2>Learning Objectives</h2>
<p>How to use JavaScript (Node.js) to load data from a JSON file and populate database tables.</p>
<h2>Pre-requisites</h2>
<ul>
<li><p>Familiarity with <a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.5-Database_access_using_Node.html">Database access using Node.js</a></p></li>
<li><p>Download this <a href="https://raw.githubusercontent.com/MultiverseLearningProducts/restaurant-data/master/restaurants.json">restaurant data file</a></p></li>
</ul>
<h2>Lesson</h2>
<p>The restaurant data you downloaded is called &quot;seed&quot; data. The data is in a <a href="https://www.w3schools.com/js/js_json_intro.asp">JSON</a> format.</p>
<p>Here is a representation of a a Restaurant object from the JSON data:</p>
<pre><code class="language-json">    {
        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Bayroot&quot;</span>,
        <span class="hljs-attr">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://www.telegraph.co.uk/content/dam/Travel/Destinations/Europe/England/Brighton/brighton-restaurants-hotel-du-vin-bistro.jpg&quot;</span>,
        <span class="hljs-attr">&quot;menus&quot;</span>: [
            {
                <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Grill&quot;</span>,
                <span class="hljs-attr">&quot;items&quot;</span>: [
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Houmous Shawarma Lamb&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">6.50</span>
                    },
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Lamb Parcels&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">5.70</span>
                    },
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Meat Balls (Kebbeh)&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">6.50</span>
                    },
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Falafel (v)&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">5.00</span>
                    }
                ]
            },
            {
                <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Cold Mezza/Starters&quot;</span>,
                <span class="hljs-attr">&quot;items&quot;</span>: [
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Houmous&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">5.00</span>
                    },
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Baba Ganoush (Moutabal) (v)&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">5.70</span>
                    },
                    {
                        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Stuffed Vine Leaves (Warak Enab)&quot;</span>,
                        <span class="hljs-attr">&quot;price&quot;</span>: <span class="hljs-number">5.70</span>
                    }
                ]
            }
        ]
    }
</code></pre>
<p>Key points to note are that:</p>
<ul>
<li>JSON objects are surrounded by curly braces {}</li>
<li>JSON objects are written in key/value pairs</li>
<li>JSON arrays are implemented with <code>[]</code> syntax</li>
<li>Keys and values are separated by a colon</li>
<li>Each key-value pair is separated by a comma</li>
<li>Keys must be always be strings and values must be a valid JSON data type i.e. one of string, number, object, array, boolean or null</li>
</ul>
<p>Looking at the data helps us decide what column names and data types we need to set up in our database. This is called the database schema. We have this already setup.</p>
<p>To insert the data into database tables, we need to firstly asychronously load the file, then iterate over the data and insert it using Prepared Statements. Before we do this, let's use the best practise of Test Driven Development (TDD) and write a unit test.</p>
<h3>Write a failing test</h3>
<p>Here is an example of a Jest test which uses the <code>beforeAll</code> method to initialise the database with our tables if they don't already exist. The test will fail as we don't yet have a load() function defined. The idea of the failing test helps you think about what you are actually trying to build.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> sqlite3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sqlite3&#x27;</span>).verbose();
<span class="hljs-keyword">const</span> load = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./index&#x27;</span>)

describe(<span class="hljs-string">&#x27;SQLite3&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    beforeAll(<span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> {
        db.exec(<span class="hljs-string">&#x27;CREATE TABLE IF NOT EXISTS restaurants(...);&#x27;</span>, done)
    })
    test(<span class="hljs-string">&#x27;restaurants are loaded into the database&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
        load(<span class="hljs-function">(<span class="hljs-params">db</span>) =&gt;</span> {
            db.all(<span class="hljs-string">&#x27;SELECT * FROM restaurants LIMIT 3;&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, row</span>) =&gt;</span> {
                expect(row.length).toBe(<span class="hljs-number">3</span>)
                expect(row[<span class="hljs-number">0</span>].name).toBe(<span class="hljs-string">&#x27;Bayroot&#x27;</span>)
                db.get(<span class="hljs-string">&#x27;SELECT COUNT(id) AS total FROM restaurants;&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, count</span>) =&gt;</span> {
                    expect(count.total).toBe(<span class="hljs-number">8</span>)
                    done()
                })
            })
        })
    })
})
</code></pre>
<h3>Reading JSON data from a file using Node.js</h3>
<p>Reading from a file may take a long time hence it is performed asynchronously.</p>
<p>Here is one version of a <code>load()</code> method which makes use of <code>async</code>/<code>await</code> to load the data into a JavaScript array, you can also write this using Promises or Callbacks.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> fsp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).promises; <span class="hljs-comment">// Node.js file system module with promises</span>

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;calling load&#x27;</span>);
    <span class="hljs-comment">// wait for the file to be read</span>
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> fsp.readFile(<span class="hljs-string">&#x27;./restaurants.json&#x27;</span>);
    <span class="hljs-keyword">const</span> restaurants = (<span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">String</span>(buffer)));
    <span class="hljs-keyword">return</span> restaurants;
}
</code></pre>
<h2>Assignment</h2>
<ol>
<li><p>Download this <a href="https://raw.githubusercontent.com/MultiverseLearningProducts/restaurant-data/master/restaurants.json">restaurant data file</a> to the directory where you completed the previous lesson.</p></li>
<li><p>Write a unit test to verify your seed data has loaded into the database ok. This will fail initially but should pass once you complete the rest of the assignment.</p></li>
<li><p>Modify the <code>populateDB.js</code> file you created in the previous lesson to include code to load the restaurant JSON data and recursively insert each Restaurant, Menu &amp; MenuItem into the database. You will be looping through a <a href="https://www.geeksforgeeks.org/multidimensional-array-in-javascript/">multi-dimensional array</a>. Remember to use <code>try/catch/finally</code> blocks to handle errors and close both the statements and database.</p></li>
<li><p>Commit your code into Github and share the link with your coach for review.</p></li>
</ol>
<h3>Assignment extension tasks</h3>
<ul>
<li>Add additional unit tests to simulate exception conditions such as the seed file not being found or the database table not existing.</li>
</ul>
<h2>Additional resources</h2>
<p>To support this lesson we recommend watching the following videos:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=iiADhChRriM">Learn JSON in 10 Minutes</a></li>
</ul>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>