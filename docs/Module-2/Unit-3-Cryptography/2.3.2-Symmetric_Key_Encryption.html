<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Symmetric Key Encryption</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum/Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum/Bootcamp/FAQ.html">FAQ</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.1-JavaScript_Objects_And_Functions.html">0.1.1 JavaScript Objects And Functions</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.6-UML_Modelling.html">0.1.6 UML Modelling</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.7-Unit_1_Challenge.html">0.1.7 Unit 1 Challenge</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/index.html">Unit 2 Asynchronous JavaScript</a><ul><li><a href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.1-Asynchronous_JavaScript.html">0.2.1 Asynchronous JavaScript</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.2-Promises.html">0.2.2 Promises</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Asynchronous_JavaScript/0.2.3-Asynchronous_Airport_Data_Load.html">0.2.3 Asynchronous Airport Data Load</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/index.html">Unit 3 Relational Databases</a><ul><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.1-Logical_Data_Model.html">0.3.1 Logical Data Model</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.10-Sequelize_part_2.html">0.3.10 Sequelize part 2</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.2-Implementing_the_Logical_Data_Model.html">0.3.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.3-Basic_SQL_Commands.html">0.3.3 Basic SQL Commands</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.4-SQL_Joins.html">0.3.4 SQL Joins</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.5-Database_access_using_Node.html">0.3.5 Database access using Node</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.6-Populating_databases_from_JSON.html">0.3.6 Populating databases from JSON</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.7-Object_Relational_Mapping_part_1.html">0.3.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.8-Object_Relational_Mapping_part_2.html">0.3.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum/Bootcamp/Unit-3-Relational_Databases/0.3.9-Sequelize_part_1.html">0.3.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/index.html">Unit 4 RESTful Servers</a><ul><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.1-Web_Servers.html">0.4.1 Web Servers</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.2-Application_Servers.html">0.4.2 Application Servers</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.3-Postman.html">0.4.3 Postman</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.4-Route_Parameters.html">0.4.4 Route Parameters</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.5-CRUD_operations.html">0.4.5 CRUD operations</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.6-Server_side_Validation.html">0.4.6 Server side Validation</a></li><li><a href="/curriculum/Bootcamp/Unit-4-RESTful_Servers/0.4.7-Unit_5_Knowledge_Quiz.html">0.4.7 Unit 5 Knowledge Quiz</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/index.html">Unit 5 Human Computer Interaction</a><ul><li><a href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.1-Human_Computer_Interaction.html">0.5.1 Human Computer Interaction</a></li><li><a href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.2-Server_Side_Rendering.html">0.5.2 Server Side Rendering</a></li><li><a href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.3-The_Document_Object_Model.html">0.5.3 The Document Object Model</a></li><li><a href="/curriculum/Bootcamp/Unit-5-Human_Computer_Interaction/0.5.4-HTML_forms_and_lists.html">0.5.4 HTML forms and lists</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/index.html">Unit 6 End Of Bootcamp Group Project</a><ul><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.1-Introduction.html">0.6.1 Introduction</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.2-Requirements.html">0.6.2 Requirements</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.3-Agile_Development.html">0.6.3 Agile Development</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.4-Design.html">0.6.4 Design</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.5-GitHub_Projects.html">0.6.5 GitHub Projects</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.6-Branching_and_Pull_Requests.html">0.6.6 Branching and Pull Requests</a></li><li><a href="/curriculum/Bootcamp/Unit-6-End_Of_Bootcamp_Group_Project/0.6.7-Deployment_with_Heroku.html">0.6.7 Deployment with Heroku</a></li></ul></li></ul></li><li><a href="/curriculum/Module-1/index.html">Module 1</a><ul><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/index.html">Unit # Advanced HTML CSS</a><ul><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.1-CSS_Fonts_and_Typography.html">0.4.1 CSS Fonts and Typography</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.1-CSS_Fundamentals.html">0.4.1 CSS Fundamentals</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.1-CSS_Positioning.html">0.4.1 CSS Positioning</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.2-CSS_Flexbox_Layout.html">0.4.2 CSS Flexbox Layout</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.4-Responsive_CSS_Media_Queries.html">0.4.4 Responsive CSS Media Queries</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.5-Responsive_CSS_Background_Images.html">0.4.5 Responsive CSS Background Images</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.6-Client_side_JavaScript.html">0.4.6 Client side JavaScript</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.6-HTML_Forms.html">0.4.6 HTML Forms</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.8-HTML_DOM_Events.html">0.4.8 HTML DOM Events</a></li><li><a href="/curriculum/Module-1/Unit-#-Advanced_HTML_CSS/0.4.8-HTML_Web_Storage_API.html">0.4.8 HTML Web Storage API</a></li></ul></li></ul></li><li><a href="/curriculum/Module-2/index.html">Module 2</a><ul><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.2-The_OpenAPI_spec.html">2.2.2 The OpenAPI spec</a></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.3-Build_an_OpenAPI_RESTful_service.html">2.2.3 Build an OpenAPI RESTful service</a></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.4-Integration_tests.html">2.2.4 Integration tests</a></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.5-Unit_2_Knowledge_quiz.html">2.2.5 Unit 2 Knowledge quiz</a></li></ul></li><li><a href="/curriculum/Module-2/Unit-3-Cryptography/index.html">Unit 3 Cryptography</a><ul><li><a href="/curriculum/Module-2/Unit-3-Cryptography/2.3.1-Hashing_Functions.html">2.3.1 Hashing Functions</a></li><li><a href="/curriculum/Module-2/Unit-3-Cryptography/2.3.2-Symmetric_Key_Encryption.html">2.3.2 Symmetric Key Encryption</a></li><li><a href="/curriculum/Module-2/Unit-3-Cryptography/2.3.3-Asymmetric_Key_Encryption.html">2.3.3 Asymmetric Key Encryption</a></li><li><a href="/curriculum/Module-2/Unit-3-Cryptography/2.3.4-Unit_3_Knowledge_Quiz.html">2.3.4 Unit 3 Knowledge Quiz</a></li></ul></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/index.html">Unit 4 Authentication</a><ul><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.1-Authentication_and_Authorisation.html">2.4.1 Authentication and Authorisation</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.2-What_is_middleware.html">2.4.2 What is middleware</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.3-Session_based_auth.html">2.4.3 Session based auth</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.4-Introduction_to_OAuth.html">2.4.4 Introduction to OAuth</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.5-Token_based_auth.html">2.4.5 Token based auth</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.6-OpenID_Connect.html">2.4.6 OpenID Connect</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.7-Banking_App.html">2.4.7 Banking App</a></li><li><a href="/curriculum/Module-2/Unit-4-Authentication/2.4.8-Unit_4_Knowledge_Quiz.html">2.4.8 Unit 4 Knowledge Quiz</a></li></ul></li></ul></li><li><a href="/curriculum/Module-3/index.html">Module 3</a><ul><li><a href="/curriculum/Module-3/Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li><li><a href="/curriculum/Module-3/Unit-2-Website_Testing/index.html">Unit 2 Website Testing</a><ul><li><a href="/curriculum/Module-3/Unit-2-Website_Testing/0.6.1-Cypress_Testing.html">0.6.1 Cypress Testing</a></li><li><a href="/curriculum/Module-3/Unit-2-Website_Testing/0.6.2-Accessibility_Testing.html">0.6.2 Accessibility Testing</a></li></ul></li></ul></li></ul></nav>
        <h1>Symmetric Key Encryption</h1>
<h2>Learning Objectives</h2>
<ul>
<li>encrypt a text message using a key</li>
<li>decrypt a text message using a key</li>
</ul>
<h2>Pre-requisites</h2>
<ul>
<li>You should have some idea about hashing algorithms see <a href="https://multiverselearningproducts.github.io/curriculum/Module-2/Unit-3-Cryptography/2.3.1-Hashing_Functions.html">2.3.1</a></li>
</ul>
<h2>Lesson</h2>
<p><figure><img src="https://sectigostore.com/blog/wp-content/uploads/2020/04/types-of-encryption-symmetric-encryption.png" alt="a diagram of symmetric encryption"><figcaption></figcaption></figure></p>
<p>Symmetric encryption uses a key to encrypt and then decrypt a message. Once a message is encrypted it can't be understood by anyone and is safe to pass around in public, or in this context send over a network. A second party with the key is the only other party who can decrypt and read your message.</p>
<p><a href="https://www.101computing.net/enigma-encoder/"><figure><img src="https://www.101computing.net/enigma/images/enigma-how-to.png" alt="The enigma code machine used symmetric encryption"><figcaption></figcaption></figure></a></p>
<p>The Enigma code machine used symmetric encryption. The operator would set up their machine at the start of each day with that day's settings. The settings came from a code book. An Enigma code book would have one page per month. The page would include all the settings for each day of the month with the first day of the month at the bottom of the page so that once used, a setting could be torn off the page.</p>
<p>❓ How is symmetric encryption different from hashing?</p>
<p>❓ These books would have been very carefully protected, why do you think that is?</p>
<p>❓ What is one of the vulnerabilities of symmetric encryption</p>
<h3>Implementing a browser based coding machine</h3>
<p>Your assignment is to work in pairs to send encrypted messages between you both using slack. Below is an example of a message that has been encrypted and is ready to send in our slack channel.</p>
<pre><code><span class="hljs-attribute">RuY2z0rri</span>/YnJPGlvOzze<span class="hljs-number">9</span>Nj+hLGQTsvTPXcljNWj/VSSvm<span class="hljs-number">9</span>PjTbo<span class="hljs-number">3</span>x<span class="hljs-number">7</span>ImFsZyI<span class="hljs-number">6</span>IkExMjhHQ<span class="hljs-number">00</span>iLCJleHQiOnRydWUsImsiOiIxSmRHS<span class="hljs-number">081</span>U<span class="hljs-number">2</span>pod<span class="hljs-number">3</span>FTSUx<span class="hljs-number">4</span>bzZSeldBIiwia<span class="hljs-number">2</span>V<span class="hljs-number">5</span>X<span class="hljs-number">29</span>wcyI<span class="hljs-number">6</span>WyJlbmNyeXB<span class="hljs-number">0</span>IiwiZGVjcnlwdCJdLCJrdHkiOiJvY<span class="hljs-number">3</span>QifQ==
</code></pre>
<p>Only your pair will be able to encrypt an decrypt each others messages. There are a few things we need to cover before we can do this using the Web Crypto API.</p>
<h3>Strings to ArrayBuffers</h3>
<p>The encryption functions we can use in the browser require your messages to be encoded as an ArrayBuffer. We like reading text as unicode characters but computers like to deal with text in different structures. Below is an example of a string converted to an ArrayBuffer. You can try this yourself using the browser based <code>TextEncoder</code>;</p>
<pre><code class="language-html">new TextEncoder().encode(&quot;We like to read unicode characters&quot;)

[87, 101, 32, 108, 105, 107, 101, 32, 116, 111, 32, 114, 101, 97, 100, 32, 117, 110, 105, 99, 111, 100, 101, 32, 99, 104, 97, 114, 97, 99, 116, 101, 114, 115]
</code></pre>
<p>❓ Why do you think an encryption function might want you to pass it a string as an ArrayBuffer?</p>
<h3>Picking an algorithm</h3>
<p>From your hashing function I hope you have learnt that it can be quite compute intensive using algorithms to hash or encrypt data. This is one of the tradeoffs that you have to consider - security vs performance. You can have a really hard to break encryption algorithm, but it will likely take time to encrypt your data, your machine's fans might start up as the processor is having to work really hard. You can cut some corners and simplify your algorithm to get better performance, but it might then be easier to break your encryption.</p>
<p>For our assignment today we are going to use the <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">'AES-GCM'</a> algorithm (Advanced Encryption Standard Galois Counter Mode).</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> algorithm = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;AES-GCM&#x27;</span>,
    <span class="hljs-attr">length</span>: <span class="hljs-number">128</span>
}
</code></pre>
<h3>Initialisation Vector</h3>
<p>Just like the enigma code machine required daily settings that were shared by both encryption and decryption agents, our code machine requires settings that must be unique and shared between both parties.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> settings = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;AES-GCM&#x27;</span>,
    <span class="hljs-attr">iv</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">229</span>, <span class="hljs-number">56</span>, <span class="hljs-number">109</span>, <span class="hljs-number">253</span>, <span class="hljs-number">36</span>, <span class="hljs-number">111</span>, <span class="hljs-number">243</span>, <span class="hljs-number">241</span>, <span class="hljs-number">13</span>, <span class="hljs-number">56</span>, <span class="hljs-number">220</span>, <span class="hljs-number">129</span>, <span class="hljs-number">127</span>, <span class="hljs-number">237</span>, <span class="hljs-number">6</span>, <span class="hljs-number">73</span>])
}
</code></pre>
<p><code>iv:</code> is short for 'initialisation vector' this is used in the algorithm that will be encrypting and decrypting your messages. You need to find a way to privately share this setting with each other. You could direct message each other on slack and share this value with each other. To generate it you can use <code>crypto.getRandomValues(new Uint8Array(16))</code>. Then share the values in the array with each other.</p>
<h3>Key Generation</h3>
<p>This is the key part. There are 2 steps we need to generate a key, and export a shareable version of it for our partner. Remember this is where symmetric encryption gets its name, the same key on both sides of the exchange.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> crypto.subtle.generateKey(algorithm, <span class="hljs-literal">true</span>, [<span class="hljs-string">&quot;encrypt&quot;</span>, <span class="hljs-string">&quot;decrypt&quot;</span>])
<span class="hljs-keyword">const</span> shareableKey = <span class="hljs-keyword">await</span> crypto.subtle.exportKey(<span class="hljs-string">&#x27;jwk&#x27;</span>, key)
</code></pre>
<p>The arguments to generateKey are the algorithm object we defined above, a boolean that decides if we can export the key or not, and an array of things we can do with the key; The shareableKey means we have a shareable version of the key that our partner can use to decrypt our messages. We can share the key with the message because without the settings you can't use it.</p>
<h3>Encryption</h3>
<p>You have everything you need to encrypt your messages (<code>encrypt</code> is async and promise based).</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> msg = <span class="hljs-string">&quot;We like to read unicode characters&quot;</span>
<span class="hljs-keyword">const</span> toEncode = <span class="hljs-keyword">new</span> TextEncoder().encode(msg)
<span class="hljs-comment">/*
  settings, key etc
*/</span>
<span class="hljs-keyword">const</span> ciphertext = <span class="hljs-keyword">await</span> crypto.subtle.encrypt(settings, key, toEncode)
</code></pre>
<p>&quot;ciphertext&quot; is the term given to our encrypted data. Its an ArrayBuffer, similar to the one we feed into the <code>encrypt</code> function.</p>
<h3>Pre-flight</h3>
<p>Now we have encrypted our message it is in an ArrayBuffer. We need to do a little more work to make this easier to transport. It's going to be tricky to copy and paste an ArrayBuffer and preserve its properties.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> encryptedBufferToString = <span class="hljs-built_in">Array</span>
    .from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(ciphertext))
    .map(<span class="hljs-function"><span class="hljs-params">byte</span> =&gt;</span> <span class="hljs-built_in">String</span>.fromCharCode(byte)).join(<span class="hljs-string">&#x27;&#x27;</span>)
<span class="hljs-keyword">const</span> toTransfer = btoa(encryptedBufferToString + <span class="hljs-string">&quot;|&quot;</span> + <span class="hljs-built_in">JSON</span>.stringify(shareableKey))
</code></pre>
<p>The code above creates a new array from the ciphertext then maps over each value and turns it back into a unicode character i.e. <code>112</code> -&gt; <code>p</code> - the array is then joined into a string.</p>
<p>The final stage is to base64 encode the joined together encryptedBufferToString (our encrypted message) and the shareable key. I have joined them using a &quot;|&quot; so the other side can 'split' on that character and extract the message and key.</p>
<p><em>use <code>btoa()</code> to encode a string to base64, use <code>atob()</code> to decode a base64 encoded string to a regular string</em></p>
<p><code>console.log(toTransfer)</code> will give you your encrypted message ready to be passed via slack.</p>
<h3>Decryption</h3>
<p>What follows can be in a totally separate file. The only thing that needs to be shared in the <code>iv</code>  (initialisation vector) settings. Unpack the pre-flight steps and get your ciphertext ArrayBuffer back in play.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> [encryptedBufferToString, shareableKey] = atob(<span class="hljs-string">&quot;RuY2z0rri/YnJPGlvOzze9Nj+hLGQTsvTPXcljNWj/VSSvm9PjTbo3x7ImFsZyI6IkExMjhHQ00iLCJleHQiOnRydWUsImsiOiIxSmRHS081U2pod3FTSUx4bzZSeldBIiwia2V5X29wcyI6WyJlbmNyeXB0IiwiZGVjcnlwdCJdLCJrdHkiOiJvY3QifQ==&quot;</span>).split(<span class="hljs-string">&quot;|&quot;</span>)
<span class="hljs-keyword">const</span> ciphertext = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(encryptedBufferToString.match(<span class="hljs-regexp">/[\s\S]/g</span>).map(<span class="hljs-function"><span class="hljs-params">ch</span> =&gt;</span> ch.charCodeAt(<span class="hljs-number">0</span>)))
</code></pre>
<p>To decrypt messages you need to get the shareableKey back to a 'crypto' key.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> crypto.subtle.importKey(<span class="hljs-string">&#x27;jwk&#x27;</span>, <span class="hljs-built_in">JSON</span>.parse(shareableKey), algorithm, <span class="hljs-literal">false</span>, [<span class="hljs-string">&quot;decrypt&quot;</span>])
</code></pre>
<p>Combine the settings, key and ciphertext to the <code>decrypt</code> function.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> decrypted = <span class="hljs-keyword">await</span> crypto.subtle.decrypt(settings, key, ciphertext)
</code></pre>
<p>Last step is to decode the ArrayBuffer into a human readable string:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> decodedMessage = <span class="hljs-keyword">new</span> TextDecoder().decode(decrypted)
</code></pre>
<p>You are now able to communicate through an encrypted channel with your partner!</p>
<h3>Summary</h3>
<p>Symmetrical encryption gets its name from the key that is the same on both sides of the exchange. The key is used to encrypt and decrypt messages. We have also learnt that the algorithms used to encrypt and decrypt messages are maths based and require strings to be formatted in a way the algorithms can work with. Not only have we transformed string to ArrayBuffers, but we have also had to encode this structures into strings which are easier to pass around.</p>
<h2>Assignment</h2>
<ul>
<li>In pairs privately share your iv settings</li>
<li>Both write the code to encrypt and decrypt each others messages</li>
<li>Use slack to pass your messages to each other</li>
<li>Try to decode other peoples messages using your code (does it work?)</li>
</ul>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>