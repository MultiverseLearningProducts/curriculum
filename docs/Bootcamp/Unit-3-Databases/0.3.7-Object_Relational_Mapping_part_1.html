<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Object Relational Mapping - part 1</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum\Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum\Bootcamp\FAQ.html">FAQ</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_and_Functions.html">0.1.1 JavaScript Objects and Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript/index.html">Unit 2 Asynchronous JavaScript</a><ul><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.1-Asynchronous_JavaScript.html">0.2.1 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.2-Asynchronous_Airport_Data_Load.html">0.2.2 Asynchronous Airport Data Load</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases/index.html">Unit 3 Databases</a><ul><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.1-Logical_Data_Model.html">0.3.1 Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.10-Sequelize_part_2.html">0.3.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.2-Implementing_the_Logical_Data_Model.html">0.3.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.3-Basic_SQL_Commands.html">0.3.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.4-SQL_Joins.html">0.3.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.5-Database_access_using_Node.html">0.3.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.6-Populating_databases_from_JSON.html">0.3.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.7-Object_Relational_Mapping_part_1.html">0.3.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.8-Object_Relational_Mapping_part_2.html">0.3.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Databases\0.3.9-Sequelize_part_1.html">0.3.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS/index.html">Unit 4 Advanced HTML CSS</a><ul><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.1-CSS_Box_Model.html">0.4.1 CSS Box Model</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.2-Responsive_CSS_Grids.html">0.4.2 Responsive CSS Grids</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.3-Flexbox.html">0.4.3 Flexbox</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.4-Client_side_JavaScript.html">0.4.4 Client side JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.5-HTML_DOM_Events.html">0.4.5 HTML DOM Events</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Advanced_HTML_CSS\0.4.6-HTML_Forms.html">0.4.6 HTML Forms</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content/index.html">Unit 5 APIs and Dynamic Content</a><ul><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.1-Web_Servers.html">0.5.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.2-Application_Servers.html">0.5.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.3-Rendering_Dynamic_Content.html">0.5.3 Rendering Dynamic Content</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.4-Route_Parameters.html">0.5.4 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.5-Server_side_Validation.html">0.5.5 Server side Validation</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.6-CRUD_operations.html">0.5.6 CRUD operations</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.7-Full_CRUD_operations.html">0.5.7 Full CRUD operations</a></li><li><a href="/curriculum\Bootcamp\Unit-5-APIs_and_Dynamic_Content\0.5.8-Restaurant_ratings.html">0.5.8 Restaurant ratings</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-6-Website_Testing/index.html">Unit 6 Website Testing</a><ul><li><a href="/curriculum\Bootcamp\Unit-6-Website_Testing\0.6.1-Cypress_Testing.html">0.6.1 Cypress Testing</a></li><li><a href="/curriculum\Bootcamp\Unit-6-Website_Testing\0.6.2-Accessibility_Testing.html">0.6.2 Accessibility Testing</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-7-End_Of_Bootcamp_Assessment/index.html">Unit 7 End Of Bootcamp Assessment</a><ul><li><a href="/curriculum\Bootcamp\Unit-7-End_Of_Bootcamp_Assessment\0.7.1-TODO.html">0.7.1 TODO</a></li></ul></li></ul></li><li><a href="/curriculum\Module-2/index.html">Module 2</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.2-The_OpenAPI_spec.html">2.2.2 The OpenAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.3-Build_an_OpenAPI_RESTful_service.html">2.2.3 Build an OpenAPI RESTful service</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.4-Integration_tests.html">2.2.4 Integration tests</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.5-Unit_2_Knowledge_quiz.html">2.2.5 Unit 2 Knowledge quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography/index.html">Unit 3 Cryptography</a><ul><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.1-Hashing_Functions.html">2.3.1 Hashing Functions</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.2-Symmetric_Key_Encryption.html">2.3.2 Symmetric Key Encryption</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.3-Asymmetric_Key_Encryption.html">2.3.3 Asymmetric Key Encryption</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.4-Unit_3_Knowledge_Quiz.html">2.3.4 Unit 3 Knowledge Quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-4-Authentication/index.html">Unit 4 Authentication</a><ul><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.1-Authentication_and_Authorisation.html">2.4.1 Authentication and Authorisation</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.2-What_is_middleware.html">2.4.2 What is middleware</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.3-Session_based_auth.html">2.4.3 Session based auth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.4-Introduction_to_OAuth.html">2.4.4 Introduction to OAuth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.5-Token_based_auth.html">2.4.5 Token based auth</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.6-OpenID_Connect.html">2.4.6 OpenID Connect</a></li><li><a href="/curriculum\Module-2\Unit-4-Authentication\2.4.7-Unit_4_Knowledge_Quiz.html">2.4.7 Unit 4 Knowledge Quiz</a></li></ul></li></ul></li><li><a href="/curriculum\Module-3/index.html">Module 3</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>Object Relational Mapping - part 1</h1>
<h2>Learning Objectives</h2>
<ul>
<li>Implement an Object Relational Mapping (ORM) design pattern</li>
</ul>
<h2>Pre-requisites</h2>
<p>Familiarity with <a href="/curriculum/Bootcamp/Unit-2-Databases/0.3.5-Database_access_using_Node.html">Database access using Node.js</a></p>
<h2>Lesson</h2>
<p>We represent objects in our programs with classes and in the database as rows. We can't store an instance of a class in the row of a database. We can't easily use the row of a database in our programs.</p>
<p>The ORM pattern is about abstracting away the database layer. It allows us to focus on creating / manipulating instances of classes such as Restaurant and delegate the work of mapping them to database fields to the ORM layer.</p>
<p>In this lesson we will manually persist Restaurant, Menu and Menu Item data as part of the class constructor. This is not a recommended approach for production (a commercial ORM system is preferred) however it will allow us to illustrate the ORM concepts.</p>
<p>In both our tests and our main program we have to make sure the database is set up with the tables we need to store our Restaurants in. We recommend creating a file that initialises the database appropriately for test or production use and exports it.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// db.js</span>
<span class="hljs-keyword">const</span> {Database} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sqlite3&#x27;</span>)
<span class="hljs-keyword">const</span> location = process.env.NODE_ENV === <span class="hljs-string">&#x27;test&#x27;</span> ? <span class="hljs-string">&#x27;:memory:&#x27;</span> : <span class="hljs-string">&#x27;./db.sqlite&#x27;</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> Database(location)
</code></pre>
<p>In the example above if we are running tests, the value of <code>process.env.NODE_ENV</code> will be 'test', so when our tests are running we always start with an empty, in-memory database. When we come to just run this code in 'development' or 'production' we specify a file that holds our data.</p>
<p>We should always start with a failing test and practise 'Test Driven Development' (TTD). Our test needs to ensure that when we create a new Restaurant it is saved to the database. However, our classes assume that the database is ready to read and write to so we can use the <code>beforeAll</code> function that Jest provides to create the required tables <em>before</em> our tests run.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> Restaurant = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./Restaurant&#x27;</span>)
<span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./db.js&#x27;</span>)

describe(<span class="hljs-string">&#x27;Restaurants&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    beforeAll(<span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
        db.run(<span class="hljs-string">&#x27;CREATE TABLE IF NOT EXISTS restaurants(id INTEGER PRIMARY KEY, name TEXT, image TEXT);&#x27;</span>, done)
    })

    test(<span class="hljs-string">&#x27;When a Restaurant is created it is stored in the database&#x27;</span>, <span class="hljs-keyword">async</span> (done) =&gt; {
        <span class="hljs-keyword">const</span> restaurant = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> Restaurant({<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Boo Jangles&#x27;</span>, <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://some.image.url&#x27;</span>})
        expect(restaurant.id).toBe(<span class="hljs-number">1</span>)
        db.get(<span class="hljs-string">&#x27;SELECT * FROM restaurants WHERE id=?;&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-function">(<span class="hljs-params">err, row</span>) =&gt;</span> {
            expect(row.name).toBe(<span class="hljs-string">&#x27;Boo Jangles&#x27;</span>)
            done()
        })
    })
})
</code></pre>
<p>We also want to test that we can create a new instance of a Restaurant from a row.</p>
<pre><code class="language-javascript">test(<span class="hljs-string">&#x27;can create an instance of an restaurant from a row&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
    db.get(<span class="hljs-string">&#x27;SELECT * FROM restaurants WHERE id=?&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">async</span> (err, row) =&gt; {
        <span class="hljs-keyword">const</span> restaurant = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> Restaurant(row)
        expect(restaurant.id).toBe(<span class="hljs-number">1</span>)
        expect(restaurant.name).toBe(<span class="hljs-string">&#x27;Boo Jangles&#x27;</span>)
        db.get(<span class="hljs-string">&#x27;SELECT COUNT(id) AS total FROM restaurants;&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, count</span>) =&gt;</span> {
            expect(count.total).toBe(<span class="hljs-number">1</span>)
            done()
        })
    })        
})
</code></pre>
<h2>Assignment</h2>
<ol>
<li><p>Create a <a href="/curriculum/Bootcamp/FAQ#createNewProject">new Node.js project</a> for this assignment.</p></li>
<li><p>Create JavaScript code to represent the 3 classes below. There is no need at this stage to worry about relationships between classes. <figure><img src="https://user-images.githubusercontent.com/1316724/111300668-3ed7d980-8649-11eb-99b2-5a842259c4ed.png" alt="UML Class Diagram showing Restaurant, Menu and MenuItem classes and attributes"><figcaption></figcaption></figure></p></li>
<li><p>Write code to persist an instance of each class to the database.</p></li>
<li><p>Write code to create an instance of each class from a database row.</p></li>
<li><p>Ensure that the unit tests described above run successfully.</p></li>
<li><p>Commit your code into Github and share the link with your coach for review.</p></li>
</ol>
<h3>Assignment extension tasks</h3>
<ul>
<li>Add additional tests to simulate error conditions</li>
</ul>
<h2>Additional resources</h2>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>