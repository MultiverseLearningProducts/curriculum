<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Securing APIs with OAuth</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><details><summary>Bootcamp</summary><ul><details><summary>Unit 1 Object Oriented Programming</summary><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.0-UML_Modelling.html">0.1.0 UML Modelling</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_And_Functions.html">0.1.1 JavaScript Objects And Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.7-OOP_Challenge.html">0.1.7 OOP Challenge</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-End_of_Unit_Quiz_OOP.html">0.1.8 End of Unit Quiz OOP</a></li></ul></details><details><summary>Unit 2 Asynchronous JavaScript</summary><ul><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.1-Asynchronous_JavaScript.html">0.2.1 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.2-Promises.html">0.2.2 Promises</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.3-Asynchronous_Airport_Data_Load.html">0.2.3 Asynchronous Airport Data Load</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Asynchronous_JavaScript\0.2.4-End_of_Unit_Quiz_Async.html">0.2.4 End of Unit Quiz Async</a></li></ul></details><details><summary>Unit 3 Relational Databases</summary><ul><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.10-Sequelize_part_2.html">0.3.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.11-End_of_Unit_Quiz_Databases.html">0.3.11 End of Unit Quiz Databases</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.2-Introduction_to_Databases.html">0.3.2 Introduction to Databases</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.3-Basic_SQL_Commands.html">0.3.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.4-SQL_Joins.html">0.3.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.5-Database_access_using_Node.html">0.3.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.6-Populating_databases_from_JSON.html">0.3.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.7-Object_Relational_Mapping_part_1.html">0.3.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.8-Object_Relational_Mapping_part_2.html">0.3.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-3-Relational_Databases\0.3.9-Sequelize_part_1.html">0.3.9 Sequelize part 1</a></li></ul></details><details><summary>Unit 4 RESTful Servers</summary><ul><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.1-Web_Servers.html">0.4.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.2-Application_Servers.html">0.4.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.3-Postman.html">0.4.3 Postman</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.4-Route_Parameters.html">0.4.4 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.5-CRUD_operations.html">0.4.5 CRUD operations</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.6-Server_side_Validation.html">0.4.6 Server side Validation</a></li><li><a href="/curriculum\Bootcamp\Unit-4-RESTful_Servers\0.4.7-End_of_Unit_Quiz_RESTful.html">0.4.7 End of Unit Quiz RESTful</a></li></ul></details><details><summary>Unit 5 Human Computer Interaction</summary><ul><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.1-Human_Computer_Interaction.html">0.5.1 Human Computer Interaction</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.2-Server_Side_Rendering.html">0.5.2 Server Side Rendering</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.3-The_Document_Object_Model.html">0.5.3 The Document Object Model</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.4-HTML_forms_and_lists.html">0.5.4 HTML forms and lists</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Human_Computer_Interaction\0.5.5-End_of_Unit_Quiz_HCI.html">0.5.5 End of Unit Quiz HCI</a></li></ul></details><details><summary>Unit 6 End Of Bootcamp Group Project</summary><ul><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.1-Introduction.html">0.6.1 Introduction</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.2-Requirements.html">0.6.2 Requirements</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.3-Agile_Development.html">0.6.3 Agile Development</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.4-Design.html">0.6.4 Design</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.5-GitHub_Projects.html">0.6.5 GitHub Projects</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.6-Branching_and_Pull_Requests.html">0.6.6 Branching and Pull Requests</a></li><li><a href="/curriculum\Bootcamp\Unit-6-End_Of_Bootcamp_Group_Project\0.6.7-Deployment_with_Heroku.html">0.6.7 Deployment with Heroku</a></li></ul></details></ul></details><details><summary>Module 1</summary><ul><details><summary>Unit 1 Agile user requirements</summary><ul><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.1-Introduction_to_Agile.html">1.1.1 Introduction to Agile</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.2-Personas.html">1.1.2 Personas</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.3-User_Stories.html">1.1.3 User Stories</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.4-Requirements.html">1.1.4 Requirements</a></li><li><a href="/curriculum\Module-1\Unit-1-Agile_user_requirements\1.1.5-Next_Steps.html">1.1.5 Next Steps</a></li></ul></details><details><summary>Unit 2 Designing UI</summary><ul><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.1-Usability_heuristics.html">1.2.1 Usability heuristics</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.2-Composition_and_components_in_design.html">1.2.2 Composition and components in design</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.3-Prototyping_UI.html">1.2.3 Prototyping UI</a></li><li><a href="/curriculum\Module-1\Unit-2-Designing_UI\1.2.4-Next_Steps.html">1.2.4 Next Steps</a></li></ul></details><details><summary>Unit 3 Building UI with React</summary><ul><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.0-Welcome_to_Unit_3.html">1.3.0 Welcome to Unit 3</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.1-Getting_started_with_React.html">1.3.1 Getting started with React</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.2-React_methods_and_computed_properties.html">1.3.2 React methods and computed properties</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.3-Events_and_adding_to_cart.html">1.3.3 Events and adding to cart</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.4-Introducing_routing_to_our_app.html">1.3.4 Introducing routing to our app</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.5-Fixing_the_add_to_cart_event.html">1.3.5 Fixing the add to cart event</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.6-Adding_the_product_details_page.html">1.3.6 Adding the product details page</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.7-Integrating_Redux_for_global_state_management.html">1.3.7 Integrating Redux for global state management</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.8-Consolidating_the_final_components.html">1.3.8 Consolidating the final components</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_React\1.3.9-Closing_thoughts_and_next_steps.html">1.3.9 Closing thoughts and next steps</a></li></ul></details><details><summary>Unit 3 Building UI with Vue.js</summary><ul><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.0-Welcome_to_Unit_3.html">1.3.0 Welcome to Unit 3</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.1-Getting_started_with_the_Vue_CDN.html">1.3.1 Getting started with the Vue CDN</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.2-Vue_methods_and_computed_properties.html">1.3.2 Vue methods and computed properties</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.3-Events_and_adding_to_cart.html">1.3.3 Events and adding to cart</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.4-Introducing_routing_to_our_app.html">1.3.4 Introducing routing to our app</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.5-Fixing_the_add_to_cart_event.html">1.3.5 Fixing the add to cart event</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.6-Adding_the_product_details_page.html">1.3.6 Adding the product details page</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.7-Integrating_Vuex_for_global_state_management.html">1.3.7 Integrating Vuex for global state management</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.8-Consolidating_the_final_components.html">1.3.8 Consolidating the final components</a></li><li><a href="/curriculum\Module-1\Unit-3-Building_UI_with_Vue.js\1.3.9-Closing_thoughts_and_next_steps.html">1.3.9 Closing thoughts and next steps</a></li></ul></details><details><summary>Unit 4 Accessibility</summary><ul><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.1-Inclusive_design.html">1.4.1 Inclusive design</a></li><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.2-Accessibility.html">1.4.2 Accessibility</a></li><li><a href="/curriculum\Module-1\Unit-4-Accessibility\1.4.3-Next_Steps.html">1.4.3 Next Steps</a></li></ul></details><details><summary>Unit 5 End to end testing</summary><ul><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.1-End_to_end_testing.html">1.5.1 End to end testing</a></li><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.2-End_to_end_testing_with_Cypress.html">1.5.2 End to end testing with Cypress</a></li><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.3-Adding_more_test_coverage.html">1.5.3 Adding more test coverage</a></li><li><a href="/curriculum\Module-1\Unit-5-End_to_end_testing\1.5.4-Test_cases_and_equivalence_testing.html">1.5.4 Test cases and equivalence testing</a></li></ul></details></ul></details><details><summary>Module 2</summary><ul><details><summary>Unit 1 Securing APIs with Basic Auth</summary><ul><li><a href="/curriculum\Module-2\Unit-1-Securing_APIs_with_Basic_Auth\2.1.1-RESTful_APIs_and_Frameworks.html">2.1.1 RESTful APIs and Frameworks</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_APIs_with_Basic_Auth\2.1.2-MOVE_TO_BOOTCAMP.html">2.1.2 MOVE TO BOOTCAMP</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_APIs_with_Basic_Auth\2.1.2-Password_Hashing.html">2.1.2 Password Hashing</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_APIs_with_Basic_Auth\2.1.3-Implementing_Basic_Auth.html">2.1.3 Implementing Basic Auth</a></li><li><a href="/curriculum\Module-2\Unit-1-Securing_APIs_with_Basic_Auth\2.1.4-Limitations_of_Basic_Auth.html">2.1.4 Limitations of Basic Auth</a></li></ul></details><details><summary>Unit 2 Securing APIs with OAuth and OpenID Connect</summary><ul><li><a href="/curriculum\Module-2\Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect\2.2.1-Introduction_to_OAuth.html">2.2.1 Introduction to OAuth</a></li><li><a href="/curriculum\Module-2\Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect\2.2.2-Securing_APIs_with_OAuth.html">2.2.2 Securing APIs with OAuth</a></li><li><a href="/curriculum\Module-2\Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect\2.2.3-OpenID_Connect.html">2.2.3 OpenID Connect</a></li><li><a href="/curriculum\Module-2\Unit-2-Securing_APIs_with_OAuth_and_OpenID_Connect\2.2.4-Module_2_assessment.html">2.2.4 Module 2 assessment</a></li></ul></details></ul></details><details><summary>Module 3</summary><ul><details><summary>Unit 1 The SDLC</summary><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-The_Software_Development_Life_Cycle.html">3.1.1 The Software Development Life Cycle</a></li><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.2-The_roles_and_responsibilities_in_the_SDLC_with_communication.html">3.1.2 The roles and responsibilities in the SDLC with communication</a></li><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.3-Communication_in_your_teams.html">3.1.3 Communication in your teams</a></li></ul></details><details><summary>Unit 2 The 7 Princibles of Testing</summary><ul><li><a href="/curriculum\Module-3\Unit-2-The-7-Princibles-of-Testing\3.2.1-The_7_Princibles_of_Testing.html">3.2.1 The 7 Princibles of Testing</a></li></ul></details><details><summary>Unit 3 Deployment and Maintenance</summary><ul><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.1-Introduction_to_Unix.html">3.3.1 Introduction to Unix</a></li><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.2-Introduction_to_containerisation.html">3.3.2 Introduction to containerisation</a></li><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.3-Introduction_to_Cloud_Computing.html">3.3.3 Introduction to Cloud Computing</a></li><li><a href="/curriculum\Module-3\Unit-3-Deployment-and-Maintenance\3.3.4-Monitoring_and_Maintenance.html">3.3.4 Monitoring and Maintenance</a></li></ul></details></ul></details><details><summary>Module 4</summary><ul><details><summary>Unit 1 Open Web Application Security Project</summary><ul><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.1-Introduction_to_the_OWASP_Top_Ten.html">4.1.1 Introduction to the OWASP Top Ten</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.2-Injection_Attacks.html">4.1.2 Injection Attacks</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.3-Broken_Authentication.html">4.1.3 Broken Authentication</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.3-Exposing_Sensitive_Data.html">4.1.3 Exposing Sensitive Data</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.4-Monitoring_for_attacks.html">4.1.4 Monitoring for attacks</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.5-The_role_of_a_Penetration_Tester.html">4.1.5 The role of a Penetration Tester</a></li><li><a href="/curriculum\Module-4\Unit-1-Open_Web_Application_Security_Project\4.1.6-Next_Steps.html">4.1.6 Next Steps</a></li></ul></details></ul></details></ul></nav>
        <h1>Securing APIs with OAuth</h1>
<h2>Learning Objectives</h2>
<ul>
<li>Understand that Auth0 is a commercial implementation of the OAuth standard</li>
<li>Secure an API using OAuth</li>
</ul>
<h1>Lesson</h1>
<p>In this lesson you will use <a href="https://auth0.com">Auth0</a>, a commercial implementation of the OAuth standard, to secure your Messages API using the programming language of your choice.</p>
<p>Auth0 is used by <a href="https://auth0.com/customers/">many well known companies</a> to secure their Web APIs. Auth0 can be used both for authentication of users and authorization to access specific APIs. In this lesson we are going to focus on API authorization via tokens issued by the Auth0 platform.</p>
<p>The diagram below illustrates the OAuth flow we will use to secure our API resource. It consists of a client app requesting a token from Auth0, then passing this token as authorization to access the Messages API:</p>
<p><figure><img src="https://user-images.githubusercontent.com/1316724/131080309-c5720022-f34a-489f-8b65-b487d50541ee.png" alt="OAuth Flow sequence diagram showing how an identify provider issues a token which is used to secure a resource"><figcaption></figcaption></figure></p>
<h2>Auth0 sign up and configuration</h2>
<p>We firstly need to create an account with Auth0 and configure a new logical API and Application.</p>
<ol>
<li><p>Go to https://auth0.com/signup - enter your email and then create a PERSONAL account type</p></li>
<li><p>Navigate to your Dashboard and select <code>Applications-&gt;APIs-&gt;Create API</code>. Name your new API <code>MessagesAPI</code> and set the Identifier to be <code>messagesAPI</code>. Note that we are not actually creating a real API here, we are merely assigning a logical name for the API which Auth0 can use to secure access.</p>
<p><img width="772" alt="Auth0 Messages API" src="https://user-images.githubusercontent.com/1316724/130799393-057d6bad-ee25-4a2c-a204-745f543af7b8.PNG"></p></li>
<li><p>Click on your new API and navigate to the <code>Test</code> tab. Click on <code>Create &amp; Authorize Test Application</code>. Again, we are not creating a real App here, we are merely assigning a logical name for an Application which will be authorised to access the Messages API.</p>
<p>You will then be presented with example code (in multiple languages) for your test application to request tokens from Auth0 and to send tokens to the MessagesAPI.</p></li>
<li><p>Use the example cURL request to help you construct a Postman request to obtain a new OAuth token.</p></li>
<li><p>If all goes well, you should receive a 200 OK and the body of the response should contain a JWT access token. Paste this into https://jwt.io and explore the contents.</p>
<p><img width="1544" alt="example token response" src="https://user-images.githubusercontent.com/1316724/130801057-ed05ee81-b974-4378-b642-f69f4f1b2577.PNG"></p></li>
</ol>
<h2>Assignment</h2>
<p>Now we have the ability to request and send tokens, we need to integrate Auth0 with the code for our Messages API created in a previous lesson. Our Messages API was previously secured using Basic Auth, you now need to change the security mechanism to be OAuth.</p>
<ol>
<li><p>You will need to research how to use OAuth in your language framework. The Additional Resources section of this page details how to set this up for Java (Spring Boot) and JavaScript (Express) developers. <strong>Note that your Auth0 Domain, Client ID and Client Secret are considered sensitive data</strong> therefore you should ensure you use environment variables / configuration files to hold this information and add the file(s) to <code>.gitignore</code> to avoid the data being saved to git.</p></li>
<li><p>Use Postman to send a token to an API endpoint. The token must be sent in an HTTP <code>Authorization</code> header of type <code>Bearer Token</code>, for example:</p>
<pre><code class="language-json">    Authorization: &quot;Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjV1SlZpY09mY1FTQ19FRTF2VER2ZyJ9.eyJpc3MiOiJodHRwczovL2Rldi0xdTF5ZzYtbS5ldS5hdXRoMC5jb20vIiwic3ViIjoid1V1cGpaTVZiVlA5VlNaeGp0dElkTnVDeDd4TXhJR1hAY2xpZW50cyIsImF1ZCI6Imh0dHBzOi8vbWFuZHlzYXBpIiwiaWF0IjoxNjI5ODk4NTgwLCJleHAiOjE2Mjk5ODQ5ODAsImF6cCI6IndVdXBqWk1WYlZQOVZTWnhqdHRJZE51Q3g3eE14SUdYIiwiZ3R5IjoiY2xpZW50LWNyZWRlbnRpYWxzIn0.FJyDPCgTUiwWw2707A56qwtlsUTJ-qqZDdY0CTW7m7kTqigJ0bayRuAa1KzJDB5HhBdDdLnVv1nzcWrOKvPd-84_51pnax8EOVkkW_vO4RL_zp89tENC9dHtXGMUqXhIwWMtiIjHoF1xJUmLfrlqmR9n3KtZr8cdELlTO7a1uESwCSQtd-iCtJ3mX2hkJ-zudmzHRxhTHGnR5XSQSx50JzKG24WXF7z-wAFuCgTadlyVvngytU0_MjyuS937kxqfDWVROy-xbo696k0iGcaH_fZo5YGkCPhKucx04FeZef52PwBelJZuN9gi6GGvj9JsZSb476Wf9Le2Y8qKwOeg2Q&quot;
</code></pre></li>
<li><p>Verify you are not able to access any <code>/messages</code> routes without a token. You should receive a status code of 401 Unauthorized.</p></li>
<li><p>Commit your code to GitHub and notify your coach that this assignment is complete.</p></li>
</ol>
<h3>Assignment extension tasks</h3>
<ol>
<li>Add the ability to secure individual endpoints based on <a href="https://auth0.com/docs/scopes/api-scopes">API scopes</a>. One scope should allow read access i.e. allow access to only the <code>GET /messages</code> and <code>GET /messages/{id?}</code> endpoints and the other scope should allow access to all endpoints. Java developers may find this <a href="https://auth0.com/blog/securing-spring-boot-apis-and-spas-with-oauth2/">help for managing scopes for Java developers</a> article useful.</li>
</ol>
<h2>Additional Resources</h2>
<h3>Integrating OAuth for Javascript developers</h3>
<ol>
<li><p>To support OAuth, you need to install some specific dependencies:</p>
<table>
<thead>
<tr><th><strong>Dependency</strong></th><th><strong>Purpose</strong></th></tr>
</thead>
<tbody>
<tr><td>express-jwt</td><td>Provides Express middleware for validating JWTs</td></tr>
<tr><td>jwks-rsa</td><td>Used to retrieve the public key used for signing the JWT</td></tr>
<tr><td>cors</td><td>Used to support Cross-origin resource sharing (CORS) - a mechanism that allows resources to be requested from another domain outside the domain from which the first resource was served</td></tr>
<tr><td>dotenv</td><td>Used to support the use of environment variables</td></tr>
</tbody>
</table>
</li>
<li><p>You will be storing details of your Auth0 account in an <code>.env</code> file hence you must add <code>.env</code> to your <code>.gitignore</code> to avoid the sensitive data being saved to git.</p></li>
<li><p>Install the following node package dependencies:<br>
<code>npm install cors dotenv express-jwt jwks-rsa</code></p></li>
<li><p>Remove any dependency to <code>express-basic-auth</code></p></li>
<li><p>Add the following to the start of your <code>app.js</code> file as follows</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-jwt&#x27;</span>);
<span class="hljs-keyword">const</span> jwksRsa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jwks-rsa&#x27;</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>); 

<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dotenv&#x27;</span>).config(<span class="hljs-string">&#x27;.env&#x27;</span>); <span class="hljs-comment">// Note: env vars should not be used in production</span>
</code></pre></li>
<li><p>Add the following line AFTER the call to initialise Express</p>
<pre><code class="language-javascript">app.use(cors());
</code></pre></li>
<li><p>Create a <code>.env</code> file to hold environment variables and add the following entries (substituting in your personal Auth0 domain):</p>
<p><code>AUTH0_AUDIENCE=messagesAPI</code></p>
<p><code>AUTH0_DOMAIN=[your domain].eu.auth0.com</code></p></li>
<li><p>Add a function to check for a valid OAuth (JWT) token:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// create middleware for checking the JWT</span>
<span class="hljs-keyword">const</span> checkJwt = jwt({
<span class="hljs-attr">secret</span>: jwksRsa.expressJwtSecret({
    <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rateLimit</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">jwksRequestsPerMinute</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">jwksUri</span>: <span class="hljs-string">`https://<span class="hljs-subst">${process.env.AUTH0_DOMAIN}</span>.well-known/jwks.json`</span>
}),
<span class="hljs-attr">audience</span>: process.env.AUTH0_AUDIENCE,
<span class="hljs-attr">issuer</span>: <span class="hljs-string">`https://<span class="hljs-subst">${process.env.AUTH0_DOMAIN}</span>`</span>,
<span class="hljs-attr">algorithms</span>: [<span class="hljs-string">&#x27;RS256&#x27;</span>]
});

</code></pre></li>
<li><p>Secure your API:</p>
<pre><code class="language-javascript">app.get(<span class="hljs-string">&quot;/messages&quot;</span>, checkJwt, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
</code></pre></li>
</ol>
<h3>Integrating OAuth for Java developers</h3>
<p>You will make use of Spring security libraries which support OAuth.</p>
<ol>
<li><p>Add the dependencies to your <code>pom.xml</code> file:</p>
<pre><code class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        ...
        <span class="hljs-tag">&lt;<span class="hljs-name">spring-security.version</span>&gt;</span>5.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">spring-security.version</span>&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-oauth2-resource-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-security.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-oauth2-jose<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-security.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-security.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre></li>
<li><p>Create a new class which checks that the JWT has the correct audience value</p>
<pre><code class="language-java"><span class="hljs-keyword">import</span> org.springframework.security.oauth2.core.OAuth2Error;
<span class="hljs-keyword">import</span> org.springframework.security.oauth2.core.OAuth2TokenValidator;
<span class="hljs-keyword">import</span> org.springframework.security.oauth2.core.OAuth2TokenValidatorResult;
<span class="hljs-keyword">import</span> org.springframework.security.oauth2.jwt.Jwt;

<span class="hljs-comment">/**
* Validates that the JWT is intended for our API.
*/</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AudienceValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OAuth2TokenValidator</span>&lt;<span class="hljs-title">Jwt</span>&gt; </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String audience;

    AudienceValidator(String audience) {
        <span class="hljs-keyword">this</span>.audience = audience;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> OAuth2TokenValidatorResult <span class="hljs-title">validate</span><span class="hljs-params">(Jwt jwt)</span> </span>{
        OAuth2Error error = <span class="hljs-keyword">new</span> OAuth2Error(<span class="hljs-string">&quot;invalid_token&quot;</span>, <span class="hljs-string">&quot;The required audience is missing&quot;</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-keyword">if</span> (jwt.getAudience().contains(audience)) {
            <span class="hljs-keyword">return</span> OAuth2TokenValidatorResult.success();
        }
        <span class="hljs-keyword">return</span> OAuth2TokenValidatorResult.failure(error);
    }
}
</code></pre></li>
<li><p>Modify your SecurityConfiguration to use OAuth</p>
<pre><code class="language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{

    <span class="hljs-meta">@Value(&quot;${auth0.audience}&quot;)</span>
    <span class="hljs-keyword">private</span> String audience;

    <span class="hljs-meta">@Value(&quot;${spring.security.oauth2.resourceserver.jwt.issuer-uri}&quot;)</span>
    <span class="hljs-keyword">private</span> String issuer;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity httpSecurity)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        httpSecurity.authorizeRequests()
                .anyRequest()
                .authenticated()
                <span class="hljs-comment">// ** IMPORTANT! do not use the line below in production apps!! **</span>
                .and().csrf().disable()
                .and().cors()
                .and().oauth2ResourceServer().jwt();
    }

    <span class="hljs-comment">/**
    * Required to enable CORS - NOT suitable for production code!
    *
    * <span class="hljs-doctag">@return</span> CorsConfigurationSource cors configuration
    */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CorsConfigurationSource <span class="hljs-title">corsConfigurationSource</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> CorsConfiguration configuration = <span class="hljs-keyword">new</span> CorsConfiguration();

        <span class="hljs-comment">// ** IMPORTANT! do not use the line below in production apps!! **</span>
        <span class="hljs-comment">// ** Specify specific origins instead</span>
        configuration.setAllowedOriginPatterns(Arrays.asList(<span class="hljs-string">&quot;*&quot;</span>));
        configuration.setAllowedMethods(Arrays.asList(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>));
        configuration.setAllowCredentials(<span class="hljs-keyword">true</span>);
        configuration.setAllowedHeaders(Arrays.asList(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>));

        <span class="hljs-keyword">final</span> UrlBasedCorsConfigurationSource source = <span class="hljs-keyword">new</span> UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(<span class="hljs-string">&quot;/**&quot;</span>, configuration);

        <span class="hljs-keyword">return</span> source;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">JwtDecoder <span class="hljs-title">jwtDecoder</span><span class="hljs-params">()</span> </span>{
        NimbusJwtDecoder jwtDecoder = (NimbusJwtDecoder)
                JwtDecoders.fromOidcIssuerLocation(issuer);

        OAuth2TokenValidator&lt;Jwt&gt; audienceValidator = <span class="hljs-keyword">new</span> AudienceValidator(audience);
        OAuth2TokenValidator&lt;Jwt&gt; withIssuer = JwtValidators.createDefaultWithIssuer(issuer);
        OAuth2TokenValidator&lt;Jwt&gt; withAudience = <span class="hljs-keyword">new</span> DelegatingOAuth2TokenValidator&lt;&gt;(withIssuer, audienceValidator);

        jwtDecoder.setJwtValidator(withAudience);

        <span class="hljs-keyword">return</span> jwtDecoder;
    }
}
</code></pre></li>
<li><p>Add a new file <code>application.yml</code> under <code>src/main/resources</code> to specify your Auth0 domain and audience</p>
<pre><code class="language-xml">auth0:
audience: messagesAPI
spring:
security:
    oauth2:
    resourceserver:
        jwt:
        issuer-uri: https://[your Auth0 domain].eu.auth0.com/
</code></pre></li>
</ol>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>