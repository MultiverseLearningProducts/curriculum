# Introduction

Now we have introduced the Product Details page, we need a way to access that Product's information so we can display it on the frontend. The problem is, passing the whole product via the router link won't work and is not a scaleable approach.

Instead, we need a central place to manage the datastate and to give the Product Details component the ability to query the state based on the dynamic ID we passed.

## Learning Objectives

- Re-imagine our app using Vuex
- Query product information by Product ID
- Display Product information on the Product Details page

## Re-imagining our app using Vuex

Let's first visualise how the Vuex store will fit in to our project:

<img src="https://raw.githubusercontent.com/MultiverseLearningProducts/curriculum/a9c756c36ecf6103467d1afb82495bc0cecb198f/assets/images/mod1_vuex.svg" alt="Module 1 - Vuex store" title="Module 1 - Vuex store">

Key points:

- All components can get and receive returned data from the store using "getters"
- All components can still have their own local state

### Step 1

In your `index.html` file, add the following script tag above `main.js`:

```html
<script src=" https://unpkg.com/vuex@3.6.2/dist/vuex.js"></script>
```

### Step 2

Add three new objects:

```js
const products = {
  state: {
    products: [
      {
        productId: 1,
        name: 'Boston Fern',
        description:
          'Nephrolepis exaltata, known as the sword fern or Boston fern, is a species of fern in the family Lomariopsidaceae native to tropical regions throughout the world.',
        features: ['Moisture loving', 'Easy care', 'Dislikes direct sun'],
        stockLevel: 5,

        // add rest of product JSON here
      },
    ],
  },
  getters: {},
};
```

```js
const cart = {
  state: {
    cart: [],
  },
  mutations: {},
  getters: {},
};
```

```js
const business = {
  state: {
    brand: 'Plants Direct',
    address: '21 Sussex Gardens',
    city: 'London',
    postcode: 'SW1 01L',
  },
  getters: {},
};
```

### Step 3

Create a new Vuex store and pass in the modules you created above:

```js
const store = new Vuex.Store({
  modules: {
    products,
    cart,
    business,
  },
});
```

### Step 4

Pass the store into your app component:

```js
var app = new Vue({
  router,
  store,
  el: '#app',

  // other fields omitted
```

### Step 5

Remove `{{this.cart.length}}` from the home page.

### Step 6

Verify your site is now loading. It won't show any products or other information just yet. We'll fix this below.

## Configuring components to use Vuex store

As you'll know, all of our components use data from the main app component, but now we want to change this so they get the data from our newly created store. Let's fix the issues one by one:

### Fixing the footer brand and address

#### Step 1

In the business module, add the following getters:

```js
getters: {
  getFullAddress(state) {
    return `${state.address}, ${state.city}, ${state.postcode}`;
  },
  getBrand(state) {
    return state.brand;
  },
},
```

The `state` parameter here is somewhat abstract as we don't actually pass in the state when using the getter methods. In this instance, it refers to the current data state of the store.

#### Step 2

In your app component, modify the computed methods as follows:

```js
 computed: {
    footerCopyrightNotice() {
      return '2021 ' + store.getters.getBrand;
    },
    footerAddress() {
      return store.getters.getFullAddress;
    },
  },
```

This should fix the footer output.

## How do getters work?

In order to access our store, we now need to use well-defined `getter` methods that exist on one of our modules. These methods only READ from the store, and can't modify or update it in any way. In this case, `getBrand` and `getFullAddress` belong to the business module and return the brand name and the address. We'll be using this getter pattern a good deal to fix the other data issues, so take a moment to review your changes to understand how it works.

## Fixing the products display

Currently our products aren't displaying. This is because the Home component needs to grab them from the store and pass them down to the Product component to render them.

### Step 1

Head to your `index.html` file and remove everything from router view and update the cart length to get the length from the cart

```html
<router-view />
```

### Step 2

Next up, add the `getAllProducts` method to the Product store's getters object:

```js
getAllProducts(state) {
  return state.products;
},
```

### Step 3

Add a computed method to the Home component to grab all the products and use this in the template to loop through each product. Also, while you're there, remove the `add-to-cart` event as we'll no longer need it.

```js
// Home component

computed: {
  getAllProducts() {
    return this.$store.getters.getAllProducts;
  },
},
```

```html
<!-- Home component -->

<product
  v-for="product in getAllProducts"
  v-bind:key="product.productId"
  v-bind:product="product"
></product>
```

## Fixing the Add to cart button

Currently the text changes, but we're not committing anything to the store and changing the cart.

### Step 1

Add the `updateCart` method to the Cart store's mutations object. This is the same solution you wrote for the coding challenge that adds/removes a Product ID from the cart.

It could look something like:

```js
mutations: {
  updateCart(state, productId) {
    if (!state.cart.includes(productId)) {
      return state.cart.push(productId);
    }
    state.cart.splice(state.cart.indexOf(productId), 1);
  },
},
```

### Step 2

In your Product component, add the following method:

```js
addToCart(product) {
  product.addedToCart = !product.addedToCart;
  this.$store.commit('updateCart', product.productId);
},
```

Here we perform the NOT trick on the product then we use `commit` to commit the change to the store by passing the event name and the new value.

This should be enough to get your cart up and running again!
