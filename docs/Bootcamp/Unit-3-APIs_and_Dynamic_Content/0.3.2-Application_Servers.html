<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Application Servers</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum\Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum\Bootcamp\FAQ.html">FAQ</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_and_Functions.html">0.1.1 JavaScript Objects and Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.6-Asynchronous_JavaScript.html">0.1.6 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.7-Asynchronous_Airport_Data_Load.html">0.1.7 Asynchronous Airport Data Load</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases/index.html">Unit 2 Databases</a><ul><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.1-Logical_Data_Model.html">0.2.1 Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.10-Sequelize_part_2.html">0.2.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.2-Implementing_the_Logical_Data_Model.html">0.2.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.3-Basic_SQL_Commands.html">0.2.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.4-SQL_Joins.html">0.2.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.5-Database_access_using_Node.html">0.2.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.6-Populating_databases_from_JSON.html">0.2.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.7-Object_Relational_Mapping_part_1.html">0.2.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.8-Object_Relational_Mapping_part_2.html">0.2.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.9-Sequelize_part_1.html">0.2.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content/index.html">Unit 3 APIs and Dynamic Content</a><ul><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.1-Web_Servers.html">0.3.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.2-Application_Servers.html">0.3.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.3-Rendering_Dynamic_Content.html">0.3.3 Rendering Dynamic Content</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.4-Responsive_CSS_Grids.html">0.3.4 Responsive CSS Grids</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.5-CSS_Box_Model.html">0.3.5 CSS Box Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.6-Route_Parameters.html">0.3.6 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.7-HTML_Forms.html">0.3.7 HTML Forms</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.8-CRUD_operations.html">0.3.8 CRUD operations</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development/index.html">Unit 4 Client side development</a><ul><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.5-Drag_and_Drop.html">0.4.5 Drag and Drop</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.6-Ajax.html">0.4.6 Ajax</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.9-Web_Accessibility.html">0.4.9 Web Accessibility</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.91-JavaScript_in_the_Browser.html">0.4.91 JavaScript in the Browser</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.92-HTML_DOM.html">0.4.92 HTML DOM</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.93-AppRun_Framework.html">0.4.93 AppRun Framework</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html">Unit 5 Software Development Lifecycle</a><ul><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Agile_Development.md/index.html">Agile Development</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Code_Reviews.md/index.html">Code Reviews</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Deployment.md/index.html">Deployment</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Design.md/index.html">Design</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Requirements.md/index.html">Requirements</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\System_Testing.md/index.html">System Testing</a></li></ul></li></ul></li><li><a href="/curriculum\Module-2/index.html">Module 2</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.2-The_OpenAPI_spec.html">2.2.2 The OpenAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.3-Build_an_OpenAPI_RESTful_service.html">2.2.3 Build an OpenAPI RESTful service</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.4-Integration_tests.html">2.2.4 Integration tests</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.5-Knowledge_quiz.html">2.2.5 Knowledge quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography/index.html">Unit 3 Cryptography</a><ul><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.1-Hashing_Functions.html">2.3.1 Hashing Functions</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.2-Symmetric_Key_Encryption.html">2.3.2 Symmetric Key Encryption</a></li></ul></li></ul></li><li><a href="/curriculum\Module-3/index.html">Module 3</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>Application Servers</h1>
<h2>Learning Objectives</h2>
<ul>
<li>Build an application server serving dynamic content using <a href="https://expressjs.com/">Node.js Express</a></li>
<li>Create dynamic content using the Handlebars templating framework</li>
</ul>
<h2>Pre-requisites</h2>
<h2>Lesson</h2>
<p>What makes content static? <b>Static</b> content is usually read from disc, it is the <em>same</em> on every request, it is the same for everyone. Examples include, image files, <code>.mp3</code> files and HTML files. We have been working with static files so far on our web server.</p>
<p><b>Dynamic content</b> is content that can <em>change</em> from request to request, and might be different for different people. For example, everyone has the same basic Facebook page, but each person's page is filled with content that is particular to them. What is shared between users is the page's template. The content is changeable or dynamic.</p>
<p>So where does the dynamic content come from? Dynamic content is usually stored in a database or comes from another service. The app responds to a request by fetching some specific content for that user/request and parses that content with a template to create the resulting HTML. The page is built per request 'on-the-fly' and is assembled by our app.</p>
<p>If we are serving dynamic content our server is now called an <b>application server</b>.</p>
<h3>Creating a Route</h3>
<p>Our server needs to intercept the HTTP request. It's no good just responding with the content of a static file or template. The way we intercept or 'handle' requests is by declaring a 'route' (also known as a REST API endpoint) in our <code>server.js</code> file. Here is an example route which returns the current date when the user navigates to the root endpoint.</p>
<pre><code class="language-javascript">app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    response.send(date)})
</code></pre>
<p>Route definitions appear <em>after</em> setting config with <code>app.use</code>, but <em>before</em> the call to <code>app.listen</code>.</p>
<p><strong>Important</strong> - Make sure you remove the <code>public/index.html</code> file to avoid it interfering with your <code>/</code> route.</p>
<h3>Creating a Template</h3>
<p>Our dynamic content is going to be driven by a Restaurant data model. We want to display a list of restaurants within a web page. To do this, we are going to use a templating framework called <a href="https://handlebarsjs.com/">Handlebars</a>. This is a well supported template library in which you write HTML and use placeholders for dynamic content.</p>
<p>A Handlebars expression is content surrounded by <code>{{</code> <code>}}</code>. When the template is executed, the expression is replaced with values from an input object.</p>
<p>Handlebars expects a specific folder structure:</p>
<pre><code class="language-sh">
views
├── restaurants.handlebars
└── layouts
    └── main.handlebars

</code></pre>
<p>The <code>views</code> folder contains Handlebars templates which get rendered into <code>layouts</code>.</p>
<p>A <code>layout</code> is an HTML page with a <code>{{{body}}}</code> placeholder into which views are rendered. The <code>layouts</code> folder typically holds a default <code>main.handlebars</code> layout.</p>
<p>In our Restaurants app we will set the <code>main.handlebars</code> layout as follows:</p>
<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/style.css&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        {{{body}}}
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>The <code>restaurants.handlebars</code> file will be rendered in the <code>main.handlebars</code> layout  and for now, will simply print out the date.</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Restaurants<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>{{date}}<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
</code></pre>
<p>We install Handlebars by running <code>npm install handlebars express-handlebars @handlebars/allow-prototype-access</code>. Once installed we can <code>require</code> it and set it as the templating engine to use in our Express code. Here is an example:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);
<span class="hljs-keyword">const</span> Handlebars = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;handlebars&#x27;</span>)
<span class="hljs-keyword">const</span> expressHandlebars = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-handlebars&#x27;</span>)
<span class="hljs-keyword">const</span> {allowInsecurePrototypeAccess} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@handlebars/allow-prototype-access&#x27;</span>)

<span class="hljs-keyword">const</span> app = express();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;

<span class="hljs-comment">// setup our templating engine</span>
<span class="hljs-keyword">const</span> handlebars = expressHandlebars({
    <span class="hljs-attr">handlebars</span>: allowInsecurePrototypeAccess(Handlebars)
})
app.engine(<span class="hljs-string">&#x27;handlebars&#x27;</span>, handlebars)
app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;handlebars&#x27;</span>)

<span class="hljs-comment">// serve static assets from the public/ folder</span>
app.use(express.static(<span class="hljs-string">&#x27;public&#x27;</span>));

<span class="hljs-comment">// this route matches any GET request to the top level URL</span>
app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> {
    response.render(<span class="hljs-string">&#x27;restaurants&#x27;</span>, {<span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()})
})

app.listen(port, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server listening at http://localhost:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2>Assignment</h2>
<ol>
<li><p>Create a <a href="/curriculum/Bootcamp/FAQ#createNewProject">new Node.js project</a> for this assignment</p></li>
<li><p>Install Handlebars using <code>npm install handlebars express-handlebars @handlebars/allow-prototype-access</code></p></li>
<li><p>Create a <code>server.js</code> file to serve both static and dynamic content as per the code above. Start your server by navigating to <code>http://localhost:3000</code>. You should see the date displayed. Use <code>Developer Tools</code> to see the HTTP requests as you refresh the page</p></li>
<li><p>Create another route handler on your server, <code>/about</code></p></li>
<li><p>Create another template in the <code>views</code> folder for your new <code>/about</code> page</p></li>
<li><p>Add a link from the <code>restaurants</code> page to the <code>about</code> page</p></li>
<li><p>Display your name on the <code>about</code> page</p></li>
<li><p>Commit your code into Github and share the link with your coach for review</p></li>
</ol>
<h3>Assignment extension tasks</h3>
<p>Read the <a href="https://handlebarsjs.com/guide/#what-is-handlebars">Handlebars documentation</a> to learn more about Handlebars expressions.</p>
<h2>Additional resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=erfN7fH7A6s">Get started with Express Handlebars</a></li>
<li><a href="https://www.youtube.com/watch?v=Yh5qW_L5YNQ">Create default Layout - Express Handlebars</a></li>
</ul>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>