# Object Relational Mapping - part 1

## Learning Objectives
* Implement an Object Relational Mapping (ORM) design pattern

## Pre-requisites

## Lesson
A relational database requires data to be stored as rows in tables. How can we map objects in our code to this kind of structure? 

The Object Relational Mapping (ORM) pattern abstracts away the database layer. It allows us to focus on creating / manipulating instances of classes such as Restaurant and delegate the work of mapping them to database fields to the ORM layer. In future lessons we'll look at how a commercial ORM framework makes this easy but let's start by trying to write this logic ourselves so we really understand what happens "under the hood".

Writing our own ORM requires us to implement methods to:
* persist an instance to the database `save()`
* locate matching rows and turn them into objects  `findAll()` / `findById`
* update a row in the database from the content of an object  `update()`
* delete one or more rows in the database `deleteAll()` / `deleteById()`

Let's start with a test - note that it is best practice for a test to avoid any network connections hence the use of an in-memory database.

|Javascript|Java|
```javascript
const { Restaurant } = require('../src/Restaurant')
const { Database } = require('sqlite3')
const db = new Database(':memory:');

describe('Restaurants', () => {
    beforeAll((done) => {

        db.run('CREATE TABLE IF NOT EXISTS restaurants(id INTEGER PRIMARY KEY, name TEXT, image TEXT);', ()=> {
            done();
        })

        Restaurant.setDatabase(db);

    })

    afterAll((done) => {
        db.close();
    })

    test('A Restaurant can be persisted in the database', async(done) => {
        // given
        const restaurant = new Restaurant('Boo Jangles', 'https://some.image.url')

        //when
        await restaurant.save();

        // then
        expect(restaurant.id).toBeGreaterThan(0)
        done()
    })

    test('A Restaurant can found in the database', async(done) => {
        // given
        const restaurant = new Restaurant('Boo Jangles', 'https://some.image.url')
        const savedRestaurant = await restaurant.save();

        // when
        let foundRestaurant = await Restaurant.findById(savedRestaurant.id);

        // then
        expect(foundRestaurant.id).toBeGreaterThan(0)
        done()
    })

    test('Multiple Restaurants can found in the database', async(done) => {
        // given
        await Restaurant.deleteAll();

        let restaurant = new Restaurant('Boo Jangles', 'https://some.image.url')
        await restaurant.save();
        restaurant = new Restaurant('Nandos', 'https://some.otherimage.url')
        await restaurant.save();

        // when
        let foundRestaurants = await Restaurant.findAll();

        // then
        console.log(foundRestaurants)
        expect(foundRestaurants.length).toBe(2)
        done()
    })

    // TODO - add more tests
})
```
```java
TODO
```

Complete the assignment and see if you can get the test above to pass. 

## Assignment

   1. Create code to represent the 3 classes below. There is no need at this stage to worry about relationships between classes. ![UML Class Diagram showing Restaurant, Menu and MenuItem classes and attributes](https://user-images.githubusercontent.com/1316724/111300668-3ed7d980-8649-11eb-99b2-5a842259c4ed.png)
   
   1. Write a `save()` method to persist an instance of each class to the database. 
   1. Write a static `findAll()` method to select all rows from a table in the database and construct object instances to represent these rows and a static `findById()` method to select a specific row from a table in the database and construct an object instance to represent this row.   
   1. Write a static `deleteAll()` method to delete all rows in a specific table and a static `deleteById()` to delete a specific row
   1. Write a static `updateById()` method to update the content of a row in the database
   1. Run the unit test above to prove your code works as expected. Add extra test cases to ensure complete code coverage.
   1. Commit your code into Github and share the link with your coach for review.

### Assignment extension tasks

## Additional resources
