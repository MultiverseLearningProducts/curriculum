<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Sequelize - part 1</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum\Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum\Bootcamp\FAQ.html">FAQ</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.1-JavaScript_Objects_and_Functions.html">0.1.1 JavaScript Objects and Functions</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.6-Asynchronous_JavaScript.html">0.1.6 Asynchronous JavaScript</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.7-Asynchronous_Airport_Data_Load.html">0.1.7 Asynchronous Airport Data Load</a></li><li><a href="/curriculum\Bootcamp\Unit-1-Object_Oriented_Programming\0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases/index.html">Unit 2 Databases</a><ul><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.1-Logical_Data_Model.html">0.2.1 Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.10-Sequelize_part_2.html">0.2.10 Sequelize part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.2-Implementing_the_Logical_Data_Model.html">0.2.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.3-Basic_SQL_Commands.html">0.2.3 Basic SQL Commands</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.4-SQL_Joins.html">0.2.4 SQL Joins</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.5-Database_access_using_Node.html">0.2.5 Database access using Node</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.6-Populating_databases_from_JSON.html">0.2.6 Populating databases from JSON</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.7-Object_Relational_Mapping_part_1.html">0.2.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.8-Object_Relational_Mapping_part_2.html">0.2.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum\Bootcamp\Unit-2-Databases\0.2.9-Sequelize_part_1.html">0.2.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content/index.html">Unit 3 APIs and Dynamic Content</a><ul><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.1-Web_Servers.html">0.3.1 Web Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.2-Application_Servers.html">0.3.2 Application Servers</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.3-Rendering_Dynamic_Content.html">0.3.3 Rendering Dynamic Content</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.4-Responsive_CSS_Grids.html">0.3.4 Responsive CSS Grids</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.5-CSS_Box_Model.html">0.3.5 CSS Box Model</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.6-Route_Parameters.html">0.3.6 Route Parameters</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.7-HTML_Forms.html">0.3.7 HTML Forms</a></li><li><a href="/curriculum\Bootcamp\Unit-3-APIs_and_Dynamic_Content\0.3.8-CRUD_operations.html">0.3.8 CRUD operations</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development/index.html">Unit 4 Client side development</a><ul><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.5-Drag_and_Drop.html">0.4.5 Drag and Drop</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.6-Ajax.html">0.4.6 Ajax</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.9-Web_Accessibility.html">0.4.9 Web Accessibility</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.91-JavaScript_in_the_Browser.html">0.4.91 JavaScript in the Browser</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.92-HTML_DOM.html">0.4.92 HTML DOM</a></li><li><a href="/curriculum\Bootcamp\Unit-4-Client_side_development\0.4.93-AppRun_Framework.html">0.4.93 AppRun Framework</a></li></ul></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html">Unit 5 Software Development Lifecycle</a><ul><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Agile_Development.md/index.html">Agile Development</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Code_Reviews.md/index.html">Code Reviews</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Deployment.md/index.html">Deployment</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Design.md/index.html">Design</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\Requirements.md/index.html">Requirements</a></li><li><a href="/curriculum\Bootcamp\Unit-5-Software_Development_Lifecycle.html\System_Testing.md/index.html">System Testing</a></li></ul></li></ul></li><li><a href="/curriculum\Module-2/index.html">Module 2</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum\Module-2\Unit-1-The_Anatomy_of_the_HTTP_request\2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.2-The_OpenAPI_spec.html">2.2.2 The OpenAPI spec</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.3-Build_an_OpenAPI_RESTful_service.html">2.2.3 Build an OpenAPI RESTful service</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.4-Integration_tests.html">2.2.4 Integration tests</a></li><li><a href="/curriculum\Module-2\Unit-2-What_is_REST\2.2.5-Knowledge_quiz.html">2.2.5 Knowledge quiz</a></li></ul></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography/index.html">Unit 3 Cryptography</a><ul><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.1-Hashing_Functions.html">2.3.1 Hashing Functions</a></li><li><a href="/curriculum\Module-2\Unit-3-Cryptography\2.3.2-Symmetric_Key_Encryption.html">2.3.2 Symmetric Key Encryption</a></li></ul></li></ul></li><li><a href="/curriculum\Module-3/index.html">Module 3</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum\Module-3\Unit-1-The-SDLC\3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>Sequelize - part 1</h1>
<h2>Pre-requisites</h2>
<p>Familiarity with <a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.5-Database_access_using_Node.html">Database access using Node</a> including the instructions described there for installing SQLite.</p>
<h2>Learning Objectives</h2>
<p>Learn the ORM pattern for the most popular SQL ORM available for Node.js - <a href="https://www.npmjs.com/package/sequelize">Sequelize</a>.</p>
<h2>Lesson</h2>
<p>It is possible to build an Object Relational Mapping (ORM) tool from scratch for each project but it is time consuming and requires careful management of resources. Your app will have a much more solid foundation if it is built with a commercial ORM framework such as Sequelize. Sequelize is a promise-based Node.js ORM for multiple database including SQLite.</p>
<h3>Installing Sequelize</h3>
<p>Install Sequelize by running:<br>
<code>npm install sequelize</code></p>
<p>Create a file named <code>sequelize_index.js</code> with the following content:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> {Sequelize, DataTypes, Model} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sequelize&#x27;</span>);

<span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> Sequelize(<span class="hljs-string">&#x27;database&#x27;</span>, <span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>, {
    <span class="hljs-attr">dialect</span>: <span class="hljs-string">&#x27;sqlite&#x27;</span>,
    <span class="hljs-attr">storage</span>: <span class="hljs-string">&#x27;./restaurants-seq.sqlite&#x27;</span>
});

 <span class="hljs-built_in">module</span>.exports={sequelize, DataTypes, Model};
</code></pre>
<p>This file contains code that would otherwise be duplicated in the individual model classes. It sets up a connection to a SQLite database and imports Sequelize types. You can see that it would be very easy to specify a different type of database in the future just by changing this config.</p>
<h3>Testing code written using Sequelize</h3>
<p>Let's start with a failing test:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> {sequelize} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./sequelize_index&#x27;</span>);
<span class="hljs-keyword">const</span> {Restaurant} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./Restaurant&#x27;</span>)

describe(<span class="hljs-string">&#x27;Restaurant&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">/**
     * Runs the code prior to all tests
     */</span>
    beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-comment">// the &#x27;sync&#x27; method will create tables based on the model class</span>
        <span class="hljs-comment">// by setting &#x27;force:true&#x27; the tables are recreated each time the </span>
        <span class="hljs-comment">// test suite is run</span>
        <span class="hljs-keyword">await</span> sequelize.sync({ <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> });
    })

    test(<span class="hljs-string">&#x27;can create a restaurant&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">await</span> sequelize.sync({ <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// recreate db</span>
        <span class="hljs-keyword">const</span> restaurant = <span class="hljs-keyword">await</span> Restaurant.create({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Ronalds&#x27;</span>, <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;http://some.image.url&#x27;</span> })
        expect(restaurant.id).toBe(<span class="hljs-number">1</span>)
    })
})
</code></pre>
<p>Before we start our tests (or later our application server) we need to call and wait for <code>sequelize.sync()</code>. This command performs a SQL query to the database and creates tables (based on our class models) or modifies the table structure to match the class models. The <code>{ force: true }</code> parameter forces the tables to be recreated each time the test suite is run (this ensures the <code>expect</code> line passes as there will only be a single row in the database).</p>
<p>In our test you can see the API for Sequelize. To create a new instance of a Restaurant we call a static method on the class called <code>create</code>. We pass in an object with the field names, and the values we want to store. In our test which kind of async function are we using?</p>
<h3>Defining the model</h3>
<p>Models are fundamental to Sequelize. A Model represents a table in your database. It is represented by a class that extends <code>Model</code>. Here is an example for the <code>Restaurant</code> class described in the <a href="/curriculum/Bootcamp/0.2.3-Basic_SQL_Commands.html">UML diagram from the Basic SQL Commands</a> lesson.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> {sequelize, DataTypes, Model} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./sequelize_index&#x27;</span>);

<span class="hljs-comment">/**
 * Represents a Restaurant
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Restaurant</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span> </span>{

    <span class="hljs-comment">// add methods here</span>

}
Restaurant.init({
    <span class="hljs-attr">name</span>: DataTypes.STRING,
    <span class="hljs-attr">image</span>: DataTypes.STRING,
}, {
    sequelize,
    <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">false</span>,
});

<span class="hljs-built_in">module</span>.exports = {
    Restaurant
};
</code></pre>
<p>In the code above we de-structure assign three constructors from the sequelize module: Sequelize, Model &amp; DataTypes.</p>
<p>Our class definition just requires us to extend from the Sequelize class <code>Model</code> (note that there are alternative methods to inheritance if required), plus the addition of an <code>init</code> method which defines the table columns and their types. The <code>timestamps: false</code> setting avoids a <code>created_at</code> column appearing. There are many more customisations you can achieve if you refer to the <a href="https://sequelize.org/master/">Sequelize documentation</a>.</p>
<h2>Assignment</h2>
<ol>
<li>Create a <a href="/curriculum/Bootcamp/FAQ#createNewProject">new Node.js project</a> for this assignment and add dependencies on SQLite and Sequelize.</li>
<li>Create Restaurant, Menu and Item classes to represent the <a href="/curriculum/Bootcamp/0.2.3-Basic_SQL_Commands.html">UML diagram from the Basic SQL Commands</a></li>
<li>Add code to map each class to a database table in a new database file (ignore relationships for now). Use the Restaurant class above as an example.</li>
<li>Create a test based on the code above to check that your tables are created and that you can insert data into them.</li>
<li>Commit your code into Github and share the link with your coach for review.</li>
</ol>
<h3>Assignment extension tasks</h3>
<ul>
<li>Think about what benefits an ORM gives over writing the database mapping code yourself. What disadvantages could using an ORM bring?</li>
</ul>
<h2>Additional resources</h2>
<p><a href="https://sequelize.org/master/">Sequalize documentation</a></p>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>