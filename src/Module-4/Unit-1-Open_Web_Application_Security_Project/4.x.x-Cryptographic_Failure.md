# Cryptographic Failure

## Learning Objectives

* Understand what cryptographic failure is
* Understand how to prevent cryptographic failure

## Cryptographic Failure

Certain data needs to be encrypted when in transit or at rest. For example, passwords should only be sent from the browser via HTTPS connections and, once on the server, should be hashed rather than stored in plain text. If either of these two criteria were to be neglected, this would be considered a cryptographic failure.

```
| id | username       | password_hash                                                |
|----|----------------|--------------------------------------------------------------|
| 1  | fluffy26       | $2a$10$qy7f0n06Xk8zA1tKQcIgReB1Xkf/JjiJU9c.mt452M9fgVm37ERwa |
| 2  | the_wizard     | $2a$10$SqW62Nj6s84q5eYxmIlAyOkXZ6fzyQ2kUyumeHoO2YArQxoirXR0W |
| 3  | anonymous98483 | $2a$10$jEk07B/EQ63luT3WdOoFcOPhD2x2E4VRz4SR64dASLFO0rnQBr09q |
```

Even if encryption is incorporated, cryptographic failures can still occur. For example, a website storing passwords as hashes would still be cryptographically unsound if they were using the MD5 algorithm to hash passwords, since this algorithm is deemed unfit for cryptography. 

An application might also be using a sound cryptographic algorithm but be mismanaging its keys. For example, the encryption key might be stored directly in the source code or might lack the complexity required to be secure.

```javascript
// INCORRECT: encryption key is too simple and stored in src code
jwt.sign({
  data
}, 'password123', { expiresIn: '1h' });
```

```javascript
// CORRECT: encryption key is injected as environmental variable
jwt.sign({
  data
}, process.env.JWT_PASSWORD, { expiresIn: '1h' });
```

## Preventing Cyrptographic Failures

- Classify data depending on whether it is sensisitive or not
- Encrypt all sensitive data at rest and in transit
- Disable caching for responses including sensistive data
- Use trusted, up-to-date cryptographic libraries
- Handle secrets appropriately (e.g. store keys in memory as byte-arrays)


## Assignment

## Additional Resources

[OWASP Cryptographic Failure](https://owasp.org/Top10/A02_2021-Cryptographic_Failures/)