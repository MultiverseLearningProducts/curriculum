<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8">
        <title> Programmatic HTTP requests</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="shortcut icon" type="image/x-icon" href="/curriculum/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/an-old-hope.min.css">
        <link rel="stylesheet" href="/curriculum/style.css"/>
        <script src="/curriculum/js/highlight.min.js"></script>
        <script src="/curriculum/js/bash.min.js"></script>
        <script src="/curriculum/js/java.min.js"></script>
        <script src="/curriculum/js/javascript.min.js"></script>
        <script src="/curriculum/js/sql.min.js"></script>
    </head>
    <body>
        <button 
            id="navigation-toggle"
            aria-expanded="false"
            aria-haspopup="true"
            onclick="toggleNav()"
            onkeydown="event => {event.keyCode === 13 ? toggleNav() : null}"
            tabindex="1">Table of contents</button>
        <nav id="navigation"><ul><li><a href="/curriculum/Bootcamp/index.html">Bootcamp</a><ul><li><a href="/curriculum/Bootcamp/FAQ.html">FAQ</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/index.html">Unit 1 Object Oriented Programming</a><ul><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.1-JavaScript_Objects_And_Functions.html">0.1.1 JavaScript Objects And Functions</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.2-Test_Driven_Development.html">0.1.2 Test Driven Development</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.3-Objects_in_an_Airport_Domain.html">0.1.3 Objects in an Airport Domain</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.4-Static_functions_and_properties.html">0.1.4 Static functions and properties</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.5-Inheritance.html">0.1.5 Inheritance</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.6-Asynchronous_JavaScript.html">0.1.6 Asynchronous JavaScript</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.7-Asynchronous_Airport_Data_Load.html">0.1.7 Asynchronous Airport Data Load</a></li><li><a href="/curriculum/Bootcamp/Unit-1-Object_Oriented_Programming/0.1.8-Scooter_Hire_System.html">0.1.8 Scooter Hire System</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/index.html">Unit 2 Databases</a><ul><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.1-Logical_Data_Model.html">0.2.1 Logical Data Model</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.10-Sequelize_part_2.html">0.2.10 Sequelize part 2</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.2-Implementing_the_Logical_Data_Model.html">0.2.2 Implementing the Logical Data Model</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.3-Basic_SQL_Commands.html">0.2.3 Basic SQL Commands</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.4-SQL_Joins.html">0.2.4 SQL Joins</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.5-Database_access_using_Node.html">0.2.5 Database access using Node</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.6-Populating_databases_from_JSON.html">0.2.6 Populating databases from JSON</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.7-Object_Relational_Mapping_part_1.html">0.2.7 Object Relational Mapping part 1</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.8-Object_Relational_Mapping_part_2.html">0.2.8 Object Relational Mapping part 2</a></li><li><a href="/curriculum/Bootcamp/Unit-2-Databases/0.2.9-Sequelize_part_1.html">0.2.9 Sequelize part 1</a></li></ul></li><li><a href="/curriculum/Bootcamp/Unit-3-API_development/index.html">Unit 3 API development</a><ul><li><a href="/curriculum/Bootcamp/Unit-3-API_development/0.3.1-Web_Servers.html">0.3.1 Web Servers</a></li><li><a href="/curriculum/Bootcamp/Unit-3-API_development/0.3.2-Application_Servers.html">0.3.2 Application Servers</a></li></ul></li></ul></li><li><a href="/curriculum/Module-2/index.html">Module 2</a><ul><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/index.html">Unit 1 The Anatomy of the HTTP request</a><ul><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/2.1.1-Identifying_the_different_parts_of_HTTP.html">2.1.1 Identifying the different parts of HTTP</a></li><li><a href="/curriculum/Module-2/Unit-1-The_Anatomy_of_the_HTTP_request/2.1.2-Programmatic_HTTP_requests.html">2.1.2 Programmatic HTTP requests</a></li></ul></li><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/index.html">Unit 2 What is REST</a><ul><li><a href="/curriculum/Module-2/Unit-2-What_is_REST/2.2.1-REST_and_the_openAPI_spec.html">2.2.1 REST and the openAPI spec</a></li></ul></li></ul></li><li><a href="/curriculum/Module-3/index.html">Module 3</a><ul><li><a href="/curriculum/Module-3/Unit-1-The-SDLC/index.html">Unit 1 The SDLC</a><ul><li><a href="/curriculum/Module-3/Unit-1-The-SDLC/3.1.1-Business_Impact.html">3.1.1 Business Impact</a></li></ul></li></ul></li></ul></nav>
        <h1>Programmatic HTTP requests</h1>
<p>In this session we are going to make sure everyone is comfortable using fetch in the browser to form more advanced HTTP requests. As well as using a tool like postman, we also want you to know how to send HTTP requests in your client-side javascript code.</p>
<h2>Learning Objectives</h2>
<ul>
<li>Set headers in a HTTP request using fetch</li>
<li>Set GET and POST methods for a fetch HTTP request</li>
</ul>
<h2>Before we start</h2>
<p>Create a new <code>index.html</code> file with a script tag, write your code in the script tag.</p>
<h2>Materials needed</h2>
<h2>Lesson</h2>
<p>Postman is a great tool, very useful for working with new APIs. In this session we are going to learn to do the things we did with postman using the Promise based fetch API in the browser.</p>
<pre><code class="language-javascript">fetch(<span class="hljs-string">`https://api.thesneakerdatabase.com/v1/sneakers?limit=10`</span>)
</code></pre>
<p>This is the most basic usage, thats a GET request (by default) to the address passed as an argument. We don't deal with the response. The response is async and is a raw response object.</p>
<pre><code class="language-javascript">fetch(<span class="hljs-string">`https://api.thesneakerdatabase.com/v1/sneakers?limit=10`</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-built_in">console</span>.table(res))
</code></pre>
<p><figure><img src="https://user-images.githubusercontent.com/4499581/102642314-635d0c00-4155-11eb-9bb6-b91c187d40cd.png" alt="an example of the response object with the status code and headers"><figcaption></figcaption></figure></p>
<p>‚ùì Can you see the status code?</p>
<p>‚ùì Are there any headers?</p>
<p>To parse the response into a more friendly JSON object we can call <code>res.json()</code> then we can access our data in a convenient format.</p>
<pre><code class="language-javascript">fetch(<span class="hljs-string">`https://api.thesneakerdatabase.com/v1/sneakers?limit=10`</span>)
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(res))
</code></pre>
<p><figure><img src="https://user-images.githubusercontent.com/4499581/102642623-ebdbac80-4155-11eb-9d63-29751bbb4a51.png" alt="data from the response"><figcaption></figcaption></figure></p>
<h3>Headers</h3>
<p>We are going to be working with the headers of our requests so lets have a look at setting headers in the fetch API. Below we are going to POST some data to our endpoint like we did earlier with postman.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> url = <span class="hljs-string">&quot;https://http-challenge.whitehatcoaches.org.uk/apprentices&quot;</span>
<span class="hljs-keyword">const</span> payload = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Frank Zappa&quot;</span>
}
fetch(url, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(payload)
})
.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.text())
.then(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> [yourId] = msg.match(<span class="hljs-regexp">/(?&lt;=\/)[a-zA-Z0-9]+(?=&#x27;)/</span>)
    <span class="hljs-built_in">console</span>.log(yourId, msg)
})
.catch(<span class="hljs-built_in">console</span>.error)
</code></pre>
<h2>Assignment</h2>
<p>Can you repeat the calls that we made earlier to https://http-challenge.whitehatcoaches.org.uk/ only this time have a script in an <code>index.html</code> page that opens in your browser, and makes use of <code>fetch</code> to make each call in sequence. You will need to retrieve the 'Your-Id' from the initial GET request and use it in the subsequence requests. You don't need to do the final applied quiz, instead submit your code to github and share a link to your repo with your coach.</p>
<h1>ü§∑üèΩ‚Äç‚ôÇÔ∏è Tips</h1>
<ul>
<li>To read the responses you need to call <code>res.text()</code></li>
<li>You'll need to pluck 'Your-Id' out of the response (see below)</li>
<li>You will have to manage a series of async requests. Remember fetch is promise based an you can chain <code>.then</code> together with one <code>.catch</code>. Any errors will be caught by your final catch function.</li>
</ul>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> [yourId] = msg.match(<span class="hljs-regexp">/(?&lt;=\/)[a-zA-Z0-9]+(?=&#x27;)/</span>)
</code></pre>

        <script src="/curriculum/js/tabbed-code-blocks.js"></script>
        <script>
            function toggleNav() {
                const button = document.getElementById('navigation-toggle')
                const isAriaExp = button.getAttribute('aria-expanded')
                const newAriaExp = (isAriaExp == "false") ? "true" : "false"
                button.setAttribute('aria-expanded', newAriaExp)
                const nav = document.getElementById('navigation')
                nav.style.display = nav.offsetParent ? 'none' : 'block'
            }
        </script>
    </body>
</html>